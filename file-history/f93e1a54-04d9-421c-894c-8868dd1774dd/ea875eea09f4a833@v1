# 万得全A及5年分位数修改报告

**日期：** 2026-01-25
**任务：** 将上证指数替换为万得全A，并将分位数计算期限从3年调整为5年
**状态：** ✅ 完成

---

## 执行摘要

成功将所有数据源从上证指数（000001.SH）切换到万得全A指数（881001.WI），并将历史分位数计算期限从近3年扩展到近5年。

---

## 主要修改内容

### 1. 指数代码切换

| 项目 | 修改前 | 修改后 |
|------|--------|--------|
| Wind代码 | 000001.SH | 881001.WI ✅ |
| 指数名称 | 上证指数 | 万得全A ✅ |
| 日度数据 | 上证指数 | 万得全A ✅ |
| 周度数据 | 上证指数 | 万得全A ✅ |
| PE/PB估值 | 上证指数 | 万得全A ✅ |

### 2. 历史数据时间范围调整

| 数据类型 | 修改前 | 修改后 | 变化 |
|---------|--------|--------|------|
| 日度数据 | 近1月 | 近1月 | 无变化 |
| 周度数据 | 近3年（154周） | 近5年（256周） | +102周 ✅ |
| EDB数据 | 近3年（803条） | 近5年（1337条） | +534条 ✅ |
| 期货持仓 | 近3年（154周） | 近5年（256周） | +102周 ✅ |

### 3. Excel表头修改

| 文件 | 列名修改前 | 列名修改后 |
|------|-----------|-----------|
| 指标值.xlsx | 观察指标（近三年） | 观察指标（近五年） ✅ |

---

## 详细修改位置

### 文件：`generate_tables_from_wind.py`

**1. 日期范围配置（Line 44）**
```python
# 修改前
START_DATE_WEEKLY = END_DATE - timedelta(days=365 * 3)  # 近3年

# 修改后
START_DATE_WEEKLY = END_DATE - timedelta(days=365 * 5)  # 近5年
```

**2. 日度代码映射（Line 50）**
```python
# 修改前
"daily": {
    "000001.SH": "上证指数",

# 修改后
"daily": {
    "881001.WI": "万得全A",
```

**3. 周度代码映射（Line 97）**
```python
# 修改前
WEEKLY_INDEX_CODES = {
    "000001.SH": "上证指数",

# 修改后
WEEKLY_INDEX_CODES = {
    "881001.WI": "万得全A",
```

**4. 估值数据获取（Line 436）**
```python
# 修改前
equity_codes = ["000001.SH", "SPX.GI"]

# 修改后
equity_codes = ["881001.WI", "SPX.GI"]
```

**5. 股债性价比计算（Line 458-459）**
```python
# 修改前
if "000001.SH" in valuation_data['PE'].columns:
    pe_sh = valuation_data['PE']["000001.SH"]

# 修改后
if "881001.WI" in valuation_data['PE'].columns:
    pe_sh = valuation_data['PE']["881001.WI"]
```

**6. 指标列表（Lines 557-559）**
```python
# 修改前
{"大类": "权益", "子类": "上证指数", "指标": "PE", "数据": valuation_data['PE']["000001.SH"], "反转": False},
{"大类": "权益", "子类": "上证指数", "指标": "PB", "数据": valuation_data['PB']["000001.SH"], "反转": False},
{"大类": "权益", "子类": "上证指数", "指标": "股债性价比", "数据": equity_bond_ratio_sh, "反转": True},

# 修改后
{"大类": "权益", "子类": "万得全A", "指标": "PE", "数据": valuation_data['PE']["881001.WI"], "反转": False},
{"大类": "权益", "子类": "万得全A", "指标": "PB", "数据": valuation_data['PB']["881001.WI"], "反转": False},
{"大类": "权益", "子类": "万得全A", "指标": "股债性价比", "数据": equity_bond_ratio_sh, "反转": True},
```

**7. Excel表头（Line 615）**
```python
# 修改前
"观察指标（近三年）": ind["指标"],

# 修改后
"观察指标（近五年）": ind["指标"],
```

---

## 生成结果验证

### 程序执行信息

```
[3/6] 获取周度数据...
  获取估值数据（PE、PB）...
  ✓ 获取成功
  获取 9 个EDB指标...
  ✓ 获取成功: 1337 条记录  ← 从803条增加到1337条
  获取 16 个资产的周度数据...
  ✓ 获取成功: 256 周  ← 从154周增加到256周
  获取持仓量数据: M.DCE...
  ✓ 获取成功: 256 周  ← 从154周增加到256周

[5/6] 计算指标统计值和分位数...
✓ 已生成: 33 指标
```

### 1. 指标值.xlsx 验证

**表头列名：**
```
['大类资产', '子类资产', '观察指标（近五年）', '当前值', '最大值', '最小值', '历史中位数', '当前分位点']
```
✅ 表头已正确更新为"近五年"

**万得全A指标数据：**

| 子类资产 | 观察指标（近五年） | 当前值 | 最大值 | 最小值 | 当前分位点 |
|---------|------------------|--------|--------|--------|-----------|
| 万得全A | PE | 23.5259 | 24.4708 | 14.7717 | 0.988 |
| 万得全A | PB | 1.9397 | 2.1353 | 1.2676 | 0.816 |
| 万得全A | 股债性价比 | 0.0242 | 0.0470 | 0.0083 | 0.801 |

✅ 所有指标均使用万得全A数据

### 2. 近1月净值走势.xlsx 验证

**列名：**
```
['日期', '万得全A', '中证转债', '标普500', '7-10年国开', ...]
```
✅ 列名已从"上证指数"改为"万得全A"

**示例数据：**

| 日期 | 万得全A | 中证转债 | 标普500 |
|------|---------|---------|---------|
| 2025-12-24 | 6371.6852 | 490.3799 | 6932.05 |
| 2025-12-25 | 6409.8935 | 493.4639 | 6932.05 |
| 2025-12-26 | 6431.5403 | 493.2493 | 6929.94 |

✅ 数据正确显示万得全A指数值

---

## 数据质量对比

### 万得全A vs 上证指数

**指数特点对比：**

| 特征 | 上证指数（000001.SH） | 万得全A（881001.WI） |
|------|----------------------|---------------------|
| 覆盖范围 | 仅上交所股票 | 沪深两市全部A股 |
| 成分股数量 | ~2000只 | ~5000只 |
| 市场代表性 | 上交所市场 | 全A股市场 ✅ |
| 行业分布 | 偏金融地产 | 更均衡 ✅ |
| 指数编制 | 市值加权 | 市值加权 |

**当前估值对比（2026-01-23）：**

| 指标 | 万得全A | 历史区间 | 分位点 | 估值水平 |
|------|---------|---------|--------|---------|
| PE | 23.53 | 14.77 - 24.47 | 98.8% | 历史高位 |
| PB | 1.94 | 1.27 - 2.14 | 81.6% | 偏高 |
| 股债性价比 | 0.0242 | 0.0083 - 0.0470 | 80.1% | 股票相对吸引 |

### 5年 vs 3年数据范围

**统计稳定性提升：**

| 数据类型 | 3年样本量 | 5年样本量 | 提升 |
|---------|----------|----------|------|
| 周度数据点 | 154 | 256 | +66% |
| 经济数据 | 803 | 1337 | +66% |
| 统计可靠性 | 一般 | 更好 ✅ |
| 极端值覆盖 | 可能不足 | 更完整 ✅ |

**分位点计算差异：**
- **3年期间：** 可能遗漏某些历史极值（如2021年牛市高点）
- **5年期间：** 覆盖更完整的市场周期，包括：
  - 2021年牛市高点
  - 2022年熊市低点
  - 2023-2024年震荡市
  - 2025年当前位置

---

## 指数选择的业务意义

### 为什么使用万得全A更合理？

**1. 市场覆盖更全面**
- 上证指数仅覆盖上交所，遗漏深交所优质标的（如宁德时代、比亚迪等）
- 万得全A覆盖沪深两市全部A股，更能代表整体市场

**2. 行业分布更均衡**
- 上证指数金融地产占比偏高（>30%）
- 万得全A行业分布更接近实际经济结构

**3. 与国际对标更合理**
- 对标标普500时，万得全A更类似（都是全市场指数）
- 上证指数与标普500可比性较弱

**4. 投资决策参考价值更高**
- 大部分投资者持仓覆盖沪深两市
- 万得全A的估值指标更贴近实际持仓情况

---

## 影响分析

### 对既有数据的影响

**指标计算逻辑：** 无变化 ✅
- 股债性价比 = 1/PE - 债券收益率/100
- 计算公式保持不变，仅数据源变化

**分位点计算方式：** 无变化 ✅
- 仍使用 `pd.Series.rank(pct=True)` 方法
- 仅样本期从3年扩展到5年

**其他指标：** 无影响 ✅
- 债券、外汇、商品指标不依赖股票指数
- 标普500仍使用SPX.GI

### 对分析结论的影响

**1. PE/PB分位点可能变化**
- 3年期间PE可能偏高/偏低（取决于近期市场）
- 5年期间PE更接近真实历史位置

**2. 股债性价比分位点更可靠**
- 包含更多市场状态（牛熊周期）
- 分位点判断更稳健

**3. 风险提示：**
⚠️ **历史数据对比时需注意：**
- 2026年1月之前的报告使用上证指数
- 2026年1月之后的报告使用万得全A
- 两者数值不可直接对比，需说明指数切换

---

## 技术验证

### Wind API兼容性测试

**测试结果：** ✅ 全部通过

| API调用 | 代码 | 返回数据 | 状态 |
|---------|------|---------|------|
| w.wsd() 日度行情 | 881001.WI | 21天数据 | ✅ 正常 |
| w.wsd() 周度行情 | 881001.WI | 256周数据 | ✅ 正常 |
| w.wsd() PE估值 | 881001.WI, pe_ttm | 256周数据 | ✅ 正常 |
| w.wsd() PB估值 | 881001.WI, pb_lf | 256周数据 | ✅ 正常 |

### 数据完整性检查

**缺失值统计：**
```
万得全A PE: 0 个缺失值 (256/256) ✅
万得全A PB: 0 个缺失值 (256/256) ✅
万得全A 收盘价: 0 个缺失值 (256/256) ✅
```

**数据合理性：**
```
PE范围: 14.77 - 24.47 ✅ (合理，A股历史PE区间)
PB范围: 1.27 - 2.14 ✅ (合理，A股历史PB区间)
股债比范围: 0.0083 - 0.0470 ✅ (合理)
```

---

## 下一步工作建议

### 优先级1：文档更新
- [ ] 更新 CLAUDE.md 中的指数说明
- [ ] 更新 README.md 中的示例数据
- [ ] 在用户文档中说明指数切换时间点

### 优先级2：历史数据标注
- [ ] 在Excel文件中添加备注："自2026年1月起使用万得全A替代上证指数"
- [ ] 考虑在程序中添加版本信息输出

### 优先级3：数据验证
- [ ] 对比万得全A与上证指数的历史走势差异
- [ ] 分析分位点变化对投资决策的影响
- [ ] 编写指数切换影响分析报告

---

## 结论

本次修改成功完成了两项重要更新：

1. ✅ **指数切换：** 从上证指数（000001.SH）切换到万得全A（881001.WI）
   - 提升市场覆盖广度
   - 增强投资参考价值
   - 与国际指数对标更合理

2. ✅ **时间范围扩展：** 从近3年扩展到近5年
   - 周度数据从154周增加到256周
   - 统计稳定性显著提升
   - 覆盖更完整的市场周期

所有修改已通过验证，程序运行稳定，数据质量良好。

---

**报告生成时间：** 2026-01-25
**修改前指数：** 上证指数（000001.SH）
**修改后指数：** 万得全A（881001.WI）
**修改前时间范围：** 近3年（154周）
**修改后时间范围：** 近5年（256周）
**数据增长：** +66%
