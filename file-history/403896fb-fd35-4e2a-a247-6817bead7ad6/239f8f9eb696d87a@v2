# åŸºé‡‘åˆ†ç±»æ ‡ç­¾ç®¡ç†ç³»ç»Ÿ - AIå®Œæ•´å¤ç°æŒ‡å—

> **æ–‡æ¡£ç”¨é€”**: æœ¬æ–‡æ¡£æä¾›ç»™AIå·¥å…·(Claudeã€ChatGPTã€Cursorç­‰),ç¡®ä¿èƒ½å¤Ÿ100%å‡†ç¡®å¤ç°ç³»ç»Ÿçš„æ‰€æœ‰åŠŸèƒ½å’Œè®¡ç®—é€»è¾‘
> **ç³»ç»Ÿç‰ˆæœ¬**: v1.1.0
> **æœ€åæ›´æ–°**: 2026-01-20

---

## ğŸ“‹ ç›®å½•

1. [ç³»ç»Ÿæ¦‚è¿°](#1-ç³»ç»Ÿæ¦‚è¿°)
2. [æŠ€æœ¯æ¶æ„](#2-æŠ€æœ¯æ¶æ„)
3. [æ•°æ®ç»“æ„è§„èŒƒ](#3-æ•°æ®ç»“æ„è§„èŒƒ)
4. [æ ¸å¿ƒè®¡ç®—é€»è¾‘](#4-æ ¸å¿ƒè®¡ç®—é€»è¾‘)
5. [åŠŸèƒ½å®ç°è¯¦è§£](#5-åŠŸèƒ½å®ç°è¯¦è§£)
6. [UIç•Œé¢è§„èŒƒ](#6-uiç•Œé¢è§„èŒƒ)
7. [å®Œæ•´ä»£ç æ¡†æ¶](#7-å®Œæ•´ä»£ç æ¡†æ¶)
8. [æµ‹è¯•éªŒè¯](#8-æµ‹è¯•éªŒè¯)

---

## 1. ç³»ç»Ÿæ¦‚è¿°

### 1.1 é¡¹ç›®å®šä½
**åŸºé‡‘åˆ†ç±»æ ‡ç­¾ç®¡ç†ç³»ç»Ÿ**æ˜¯ä¸€ä¸ªä¸“ä¸ºé“¶è¡Œç†è´¢èµ„ç®¡æœºæ„è®¾è®¡çš„çº¯å‰ç«¯å•é¡µåº”ç”¨,ç”¨äºåˆ†æå’Œå¯è§†åŒ–å¤šä¸ªç†è´¢äº§å“çš„æƒç›Šæš´éœ²æƒ…å†µã€‚

### 1.2 ä¸šåŠ¡åœºæ™¯
æŸé“¶è¡Œç†è´¢éƒ¨é—¨ç®¡ç†å¤šä¸ªç†è´¢äº§å“(å¦‚"ä¸°åˆ©é€¸åŠ¨1ä¸ªæœˆå¢å¼ºå‹"ã€"ä¸°åˆ©é€¸åŠ¨10ä¸ªæœˆå¢å¼ºå‹"ç­‰),æ¯ä¸ªäº§å“æŠ•èµ„äº†ä¸åŒçš„åŸºé‡‘ã€‚éœ€è¦:
1. ä¸Šä¼ ExcelæŒä»“æ˜ç»†è¡¨
2. è‡ªåŠ¨è¯†åˆ«æ¯ä¸ªäº§å“æŒæœ‰çš„åŸºé‡‘
3. æ ¹æ®åŸºé‡‘çš„"é£æ ¼"(çº¢åˆ©/å‡è¡¡/ç§‘æŠ€æˆé•¿/å‘¨æœŸ/ä»·å€¼)å’Œ"æƒç›Šä»“ä½"
4. è®¡ç®—æ¯ä¸ªäº§å“åœ¨ä¸åŒé£æ ¼ä¸Šçš„æƒç›Šæš´éœ²é‡‘é¢å’Œå æ¯”
5. å¤šç»´åº¦å¯è§†åŒ–å±•ç¤ºç»“æœ

### 1.3 æ ¸å¿ƒä»·å€¼
- **è‡ªåŠ¨åŒ–**: ä»æ‰‹å·¥Excelè®¡ç®—åˆ°ä¸€é”®ä¸Šä¼ è‡ªåŠ¨åˆ†æ
- **æ™ºèƒ½åŒ–**: è‡ªåŠ¨æ£€æµ‹æ–°åŸºé‡‘,æç¤ºç”¨æˆ·åˆ†ç±»
- **å¯è§†åŒ–**: å›¾è¡¨+çŸ©é˜µ+è¯¦è¡¨å¤šç»´åº¦å±•ç¤º
- **ç¦»çº¿åŒ–**: å®Œå…¨ç¦»çº¿è¿è¡Œ,é€‚åˆå†…ç½‘ç¯å¢ƒ

### 1.4 æŠ€æœ¯æ ˆ
```
å‰ç«¯: çº¯HTML + CSS + JavaScript (ES6)
Excelè§£æ: SheetJS (xlsx.full.min.js)
å›¾è¡¨: Chart.js v4.5.0+
å­˜å‚¨: LocalStorage
éƒ¨ç½²: å•HTMLæ–‡ä»¶,æ— éœ€æœåŠ¡å™¨
```

---

## 2. æŠ€æœ¯æ¶æ„

### 2.1 æ–‡ä»¶ç»“æ„
```
é¡¹ç›®ç›®å½•/
â”œâ”€â”€ fund_analysis.html      (ä¸»æ–‡ä»¶,åŒ…å«æ‰€æœ‰HTML/CSS/JS)
â”œâ”€â”€ xlsx.full.min.js        (Excelè§£æåº“,ç¦»çº¿)
â”œâ”€â”€ chart.js                (å›¾è¡¨åº“,ç¦»çº¿)
â”œâ”€â”€ åŸºé‡‘åˆ†ç±»æ•°æ®.json        (å¯é€‰,å¤‡ä»½æ•°æ®)
â””â”€â”€ æŒä»“æ˜ç»†è¡¨.xlsx          (ç”¨æˆ·ä¸Šä¼ çš„Excelæ–‡ä»¶)
```

### 2.2 å•HTMLæ¶æ„
æ•´ä¸ªç³»ç»Ÿåœ¨ä¸€ä¸ªHTMLæ–‡ä»¶ä¸­å®ç°:
```html
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>åŸºé‡‘åˆ†ç±»æ ‡ç­¾ç®¡ç†ç³»ç»Ÿ</title>
    <script src="xlsx.full.min.js"></script>
    <script src="chart.js"></script>
    <style>
        /* æ‰€æœ‰CSSæ ·å¼ */
    </style>
</head>
<body>
    <!-- æ‰€æœ‰HTMLç»“æ„ -->
    <script>
        /* æ‰€æœ‰JavaScriptä»£ç  */
    </script>
</body>
</html>
```

### 2.3 æ•°æ®æµå›¾
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç”¨æˆ·ä¸Šä¼ Excel â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FileReaderè¯»å–   â”‚
â”‚ XLSX.readè§£æ   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ processData() ä¸»å¤„ç†å‡½æ•°  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. è®¡ç®—äº§å“å‡€èµ„äº§        â”‚
â”‚    (æ€»æŒä»“ - æ­£å›è´­)     â”‚
â”‚ 2. æ£€æµ‹æœªåˆ†ç±»åŸºé‡‘        â”‚
â”‚ 3. åŒ¹é…åŸºé‡‘åˆ†ç±»          â”‚
â”‚ 4. è®¡ç®—æƒç›Šæš´éœ²          â”‚
â”‚ 5. æŒ‰é£æ ¼åˆ†ç»„æ±‡æ€»        â”‚
â”‚ 6. è®¡ç®—å æ¯”              â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å¤šç»´åº¦æ¸²æŸ“               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ æ±‡æ€»ç»Ÿè®¡å¡ç‰‡           â”‚
â”‚ â€¢ çŸ©é˜µè¡¨æ ¼(äº§å“Ã—é£æ ¼)    â”‚
â”‚ â€¢ äº§å“å¡ç‰‡+ç¯å½¢å›¾        â”‚
â”‚ â€¢ è¯¦ç»†æ•°æ®è¡¨æ ¼           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.4 æ ¸å¿ƒå…¨å±€å˜é‡
```javascript
// å¸¸é‡
const defaultFundClassifications = { ... };  // é»˜è®¤66ä¸ªåŸºé‡‘æ•°æ®åº“
const STORAGE_KEY = 'fund_classifications_data';
const FUND_EQUITY_SUBCLASS_RULES = { ... };  // æƒç›Šç±»èµ„äº§è§„åˆ™

// è¿è¡Œæ—¶çŠ¶æ€
let fundClassifications = {};     // å½“å‰åŸºé‡‘åˆ†ç±»æ•°æ®
let holdingData = [];             // Excelè§£æåçš„æ•°ç»„
let analysisResults = {};         // {äº§å“å: {é£æ ¼: {amount, percentage}}}
let selectedProducts = new Set(); // é€‰ä¸­çš„äº§å“
let matrixDisplayType = 'amount'; // çŸ©é˜µæ˜¾ç¤ºæ¨¡å¼
let unclassifiedFunds = [];       // æœªåˆ†ç±»åŸºé‡‘
```

---

## 3. æ•°æ®ç»“æ„è§„èŒƒ

### 3.1 Excelè¾“å…¥æ–‡ä»¶æ ¼å¼

**å¿…éœ€åˆ—å**(å¤§å°å†™æ•æ„Ÿ,å¿…é¡»å®Œå…¨åŒ¹é…):
```
äº§å“ç®€ç§°                    - äº§å“åç§°,å¦‚"ä¸°åˆ©é€¸åŠ¨1ä¸ªæœˆæœ€çŸ­æŒæœ‰æœŸæ—¥å¼€1å·å¢å¼ºå‹"
èµ„äº§ä»£ç                     - å†…éƒ¨èµ„äº§ä»£ç ,å¦‚"80PF2216281"
å¤–éƒ¨ä»£ç                     - å¤–éƒ¨æ ‡è¯†ç ,å¦‚"011691.OF"
èµ„äº§ç®€ç§°                    - èµ„äº§åç§°,å¦‚"æ‹›å•†å“è´¨å‘ç°æ··åˆå‹è¯åˆ¸æŠ•èµ„åŸºé‡‘"
æ—¥ç»ˆå¸‚å€¼(å…ƒ)-äº§å“æ³•ä¼°å€¼      - æŒä»“é‡‘é¢,æ•°å€¼å‹,å¦‚ 2760134.15
æ–°ç‰ˆèµ„äº§å¤§ç±»                - ä¸€çº§åˆ†ç±»,å¦‚"å…¬å‹ŸåŸºé‡‘"ã€"å§”å¤–æŠ•èµ„"
æ–°ç‰ˆèµ„äº§å°ç±»                - äºŒçº§åˆ†ç±»,å¦‚"å…¬å‹Ÿæ··åˆåŸºé‡‘"ã€"å…¬å‹Ÿè‚¡ç¥¨åŸºé‡‘"
```

**Excelæ•°æ®ç¤ºä¾‹**:
| äº§å“ç®€ç§° | èµ„äº§ä»£ç  | å¤–éƒ¨ä»£ç  | èµ„äº§ç®€ç§° | æ—¥ç»ˆå¸‚å€¼(å…ƒ)-äº§å“æ³•ä¼°å€¼ | æ–°ç‰ˆèµ„äº§å¤§ç±» | æ–°ç‰ˆèµ„äº§å°ç±» |
|---------|---------|---------|---------|----------------------|------------|------------|
| ä¸°åˆ©é€¸åŠ¨1ä¸ªæœˆ... | 80PF2216281 | 011691.OF | æ‹›å•†å“è´¨å‘ç°æ··åˆ... | 2760134.15 | å…¬å‹ŸåŸºé‡‘ | å…¬å‹Ÿæ··åˆåŸºé‡‘ |
| ä¸°åˆ©é€¸åŠ¨1ä¸ªæœˆ... | SECREPO250715... | | æ­£å›è´­ | 10000000.00 | æ­£å›è´­ | æ­£å›è´­ |
| ä¸°åˆ©é€¸åŠ¨10ä¸ªæœˆ... | 80PF2216594 | 013642.OF | åšé“æˆé•¿æ™ºèˆªè‚¡ç¥¨... | 2070156.79 | å…¬å‹ŸåŸºé‡‘ | å…¬å‹Ÿè‚¡ç¥¨åŸºé‡‘ |

### 3.2 åŸºé‡‘åˆ†ç±»æ•°æ®ç»“æ„

**å­˜å‚¨åœ¨LocalStorageä¸­çš„JSONå¯¹è±¡**:
```javascript
{
    "011691.OF": {                      // é”®:åŒ¹é…é”®(å¤–éƒ¨ä»£ç /èµ„äº§ä»£ç /èµ„äº§ç®€ç§°)
        "assetClass": "å…¬å‹Ÿæ··åˆåŸºé‡‘",    // èµ„äº§å°ç±»
        "style": "å‡è¡¡",                 // æŠ•èµ„é£æ ¼(5é€‰1)
        "equityPosition": 100            // æƒç›Šä»“ä½(0-100æ•´æ•°)
    },
    "002361.OF": {
        "assetClass": "äºŒçº§å…¬å‹Ÿå€ºåˆ¸åŸºé‡‘",
        "style": "å‡è¡¡",
        "equityPosition": 20
    },
    "11PF242490": {                      // å§”å¤–æŠ•èµ„ä½¿ç”¨èµ„äº§ä»£ç ä½œä¸ºé”®
        "assetClass": "å§”å¤–éç°å›ºå®šæ”¶ç›Šç±»èµ„äº§",
        "style": "å‡è¡¡",
        "equityPosition": 18
    }
}
```

**æŠ•èµ„é£æ ¼æšä¸¾**(5ç§,å›ºå®šé¡ºåº):
```javascript
const STYLES = ['çº¢åˆ©', 'å‡è¡¡', 'ç§‘æŠ€æˆé•¿', 'å‘¨æœŸ', 'ä»·å€¼'];
```

**èµ„äº§å°ç±»æšä¸¾**(å«æƒç›Šçš„):
```javascript
const EQUITY_ASSET_CLASSES = [
    'å…¬å‹Ÿè‚¡ç¥¨åŸºé‡‘',              // 100%
    'æ™®é€šè‚¡ç¥¨å‹åŸºé‡‘',            // 100%
    'å…¬å‹Ÿæ··åˆåŸºé‡‘',              // 100%
    'åè‚¡æ··åˆå‹åŸºé‡‘',            // 80%
    'çµæ´»é…ç½®å‹åŸºé‡‘',            // 80%
    'äºŒçº§å…¬å‹Ÿå€ºåˆ¸åŸºé‡‘',          // 20%
    'æ··åˆå€ºåˆ¸å‹äºŒçº§åŸºé‡‘',        // 20%
    'å…¶ä»–å…¬å‹ŸåŸºé‡‘',              // 100%
    'è¢«åŠ¨æŒ‡æ•°å‹åŸºé‡‘',            // 100%
    'å›½é™…(QDII)è¢«åŠ¨æŒ‡æ•°å‹è‚¡ç¥¨åŸºé‡‘' // 100%
];
```

### 3.3 æœªåˆ†ç±»åŸºé‡‘å¯¹è±¡
```javascript
{
    assetName: "æ–°æ£€æµ‹åŸºé‡‘åç§°",      // èµ„äº§ç®€ç§°
    matchKey: "123456.OF",          // åŒ¹é…é”®
    externalCode: "123456.OF",      // å¤–éƒ¨ä»£ç 
    assetSubClass: "å…¬å‹Ÿè‚¡ç¥¨åŸºé‡‘",   // èµ„äº§å°ç±»
    style: "",                      // å¾…ç”¨æˆ·è®¾ç½®
    equityPosition: 100             // æ ¹æ®èµ„äº§å°ç±»è‡ªåŠ¨è®¾ç½®é»˜è®¤å€¼
}
```

### 3.4 åˆ†æç»“æœæ•°æ®ç»“æ„
```javascript
analysisResults = {
    "ä¸°åˆ©é€¸åŠ¨1ä¸ªæœˆ...": {
        "çº¢åˆ©": {
            amount: 5000000,           // æƒç›Šæš´éœ²é‡‘é¢(å…ƒ)
            percentage: 25.5           // å æ¯”(%)
        },
        "å‡è¡¡": {
            amount: 10000000,
            percentage: 51.0
        },
        "ç§‘æŠ€æˆé•¿": {
            amount: 4600000,
            percentage: 23.5
        }
    },
    "ä¸°åˆ©é€¸åŠ¨10ä¸ªæœˆ...": { ... }
}
```

---

## 4. æ ¸å¿ƒè®¡ç®—é€»è¾‘

### 4.1 åŸºé‡‘åŒ¹é…é”®ç”Ÿæˆ(getFundMatchKey)

**è¿™æ˜¯ç³»ç»Ÿæœ€å…³é”®çš„é€»è¾‘ä¹‹ä¸€!**

```javascript
function getFundMatchKey(row) {
    const assetClass = normalizeText(row['æ–°ç‰ˆèµ„äº§å¤§ç±»']);
    const externalCode = normalizeText(row['å¤–éƒ¨ä»£ç ']);
    const assetCode = normalizeText(row['èµ„äº§ä»£ç ']);
    const assetName = normalizeText(row['èµ„äº§ç®€ç§°']);

    // è§„åˆ™1: å…¬å‹ŸåŸºé‡‘ä¼˜å…ˆä½¿ç”¨å¤–éƒ¨ä»£ç 
    if (assetClass === 'å…¬å‹ŸåŸºé‡‘' && externalCode) {
        return externalCode;
    }

    // è§„åˆ™2: å§”å¤–æŠ•èµ„ä½¿ç”¨èµ„äº§ä»£ç 
    if (assetClass === 'å§”å¤–æŠ•èµ„' && assetCode) {
        return assetCode;
    }

    // è§„åˆ™3: å…¶ä»–æƒ…å†µä½¿ç”¨èµ„äº§ç®€ç§°
    return assetName;
}
```

**åŒ¹é…ç¤ºä¾‹**:
```
è¾“å…¥: {æ–°ç‰ˆèµ„äº§å¤§ç±»:'å…¬å‹ŸåŸºé‡‘', å¤–éƒ¨ä»£ç :'011691.OF', èµ„äº§ç®€ç§°:'æ‹›å•†å“è´¨å‘ç°...'}
è¾“å‡º: "011691.OF"

è¾“å…¥: {æ–°ç‰ˆèµ„äº§å¤§ç±»:'å§”å¤–æŠ•èµ„', èµ„äº§ä»£ç :'11PF242490', èµ„äº§ç®€ç§°:'å…´ä¸šä¿¡æ‰˜...'}
è¾“å‡º: "11PF242490"

è¾“å…¥: {æ–°ç‰ˆèµ„äº§å¤§ç±»:'å…¶ä»–', å¤–éƒ¨ä»£ç :'', èµ„äº§ç®€ç§°:'åæ³°æŸç‘çº¢åˆ©ETF ( 510880.SH )'}
è¾“å‡º: "åæ³°æŸç‘çº¢åˆ©ETF ( 510880.SH )"
```

### 4.2 äº§å“å‡€èµ„äº§è®¡ç®—

**å…¬å¼**: äº§å“å‡€èµ„äº§ = Î£æŒä»“é‡‘é¢ - æ­£å›è´­é‡‘é¢

**ä»£ç å®ç°**:
```javascript
// ç¬¬ä¸€éå¾ªç¯:è®¡ç®—å„äº§å“å‡€èµ„äº§
const productNetAssets = {};
holdingData.forEach(row => {
    const productName = normalizeText(row['äº§å“ç®€ç§°']);
    const assetName = normalizeText(row['èµ„äº§ç®€ç§°']);
    const holdingAmount = parseFloat(row['æ—¥ç»ˆå¸‚å€¼(å…ƒ)-äº§å“æ³•ä¼°å€¼']) || 0;

    if (!productName || holdingAmount === 0) return;

    if (!productNetAssets[productName]) {
        productNetAssets[productName] = 0;
    }

    // å…³é”®:æ£€æµ‹æ­£å›è´­
    const isRepo = assetName && assetName.includes('æ­£å›è´­');

    if (isRepo) {
        // æ­£å›è´­å‡å»(æ³¨æ„:æ­£å›è´­é‡‘é¢æœ¬èº«å¯èƒ½æ˜¯è´Ÿæ•°)
        productNetAssets[productName] -= holdingAmount;
    } else {
        // å…¶ä»–èµ„äº§åŠ ä¸Š
        productNetAssets[productName] += holdingAmount;
    }
});
```

**è®¡ç®—ç¤ºä¾‹**:
```
äº§å“AæŒä»“æ˜ç»†:
1. æ‹›å•†å“è´¨å‘ç°åŸºé‡‘:    2,760,134.15å…ƒ
2. åšé“ç››å½¦åŸºé‡‘:        2,804,248.70å…ƒ
3. æ‰˜ç®¡è´¦æˆ·:           17,263,030.00å…ƒ
4. æ­£å›è´­(é“¶è¡Œé—´):     10,000,000.00å…ƒ  â† æ³¨æ„è¿™é‡Œ

è®¡ç®—è¿‡ç¨‹:
å‡€èµ„äº§ = 2,760,134.15 + 2,804,248.70 + 17,263,030 - 10,000,000
      = 12,827,412.85å…ƒ
```

### 4.3 æƒç›Šæš´éœ²é‡‘é¢è®¡ç®—

**å…¬å¼**: æƒç›Šæš´éœ²é‡‘é¢ = æŒä»“é‡‘é¢ Ã— (æƒç›Šä»“ä½ / 100)

**ä»£ç å®ç°**:
```javascript
holdingData.forEach(row => {
    const productName = normalizeText(row['äº§å“ç®€ç§°']);
    const holdingAmount = parseFloat(row['æ—¥ç»ˆå¸‚å€¼(å…ƒ)-äº§å“æ³•ä¼°å€¼']) || 0;

    // ç”ŸæˆåŒ¹é…é”®
    const matchKey = getFundMatchKey(row);

    // æŸ¥æ‰¾åˆ†ç±»
    const classification = fundClassifications[matchKey];
    if (!classification) return; // è·³è¿‡æœªåˆ†ç±»åŸºé‡‘

    // è®¡ç®—æƒç›Šæš´éœ²
    const equityExposure = holdingAmount * (classification.equityPosition / 100);

    // æŒ‰äº§å“å’Œé£æ ¼åˆ†ç»„ç´¯åŠ 
    if (!productResults[productName]) {
        productResults[productName] = {};
    }
    if (!productResults[productName][classification.style]) {
        productResults[productName][classification.style] = 0;
    }
    productResults[productName][classification.style] += equityExposure;
});
```

**è®¡ç®—ç¤ºä¾‹**:
```
æ¡ˆä¾‹1: æ‹›å•†å“è´¨å‘ç°æ··åˆåŸºé‡‘
æŒä»“é‡‘é¢: 2,760,134.15å…ƒ
æƒç›Šä»“ä½: 100%
æƒç›Šæš´éœ² = 2,760,134.15 Ã— (100/100) = 2,760,134.15å…ƒ

æ¡ˆä¾‹2: æ™¯é¡ºé•¿åŸæ™¯é¢åŒåˆ©(äºŒçº§å€ºåŸº)
æŒä»“é‡‘é¢: 5,080,751.37å…ƒ
æƒç›Šä»“ä½: 20%
æƒç›Šæš´éœ² = 5,080,751.37 Ã— (20/100) = 1,016,150.27å…ƒ
```

### 4.4 é£æ ¼æƒç›Šæš´éœ²å æ¯”è®¡ç®—

**å…¬å¼**: é£æ ¼å æ¯” = (è¯¥é£æ ¼æƒç›Šæš´éœ²é‡‘é¢ä¹‹å’Œ / è¯¥äº§å“æ‰€æœ‰é£æ ¼æƒç›Šæš´éœ²é‡‘é¢ä¹‹å’Œ) Ã— 100%

**ä»£ç å®ç°**:
```javascript
// ç¬¬ä¸‰æ­¥:è®¡ç®—å æ¯”
Object.keys(productResults).forEach(productName => {
    // è®¡ç®—æ€»æƒç›Šæš´éœ²
    const totalEquity = Object.values(productResults[productName])
        .reduce((sum, amount) => sum + amount, 0);

    // è®¡ç®—å„é£æ ¼å æ¯”
    Object.keys(productResults[productName]).forEach(style => {
        const amount = productResults[productName][style];
        const percentage = totalEquity > 0 ? (amount / totalEquity) * 100 : 0;

        productResults[productName][style] = {
            amount: amount,
            percentage: percentage
        };
    });
});
```

**è®¡ç®—ç¤ºä¾‹**:
```
äº§å“AåŸºé‡‘æŒä»“(å·²è®¡ç®—æƒç›Šæš´éœ²):
1. æ‹›å•†å“è´¨å‘ç°(å‡è¡¡,100%):     æŒä»“276ä¸‡ â†’ æƒç›Šæš´éœ²276ä¸‡
2. åšé“ç››å½¦(ç§‘æŠ€æˆé•¿,100%):      æŒä»“280ä¸‡ â†’ æƒç›Šæš´éœ²280ä¸‡
3. æ™¯é¡ºæ™¯é¢åŒåˆ©(å‡è¡¡,20%):       æŒä»“508ä¸‡ â†’ æƒç›Šæš´éœ²101.6ä¸‡

æŒ‰é£æ ¼æ±‡æ€»:
  å‡è¡¡é£æ ¼ = 276 + 101.6 = 377.6ä¸‡
  ç§‘æŠ€æˆé•¿ = 280ä¸‡

æ€»æƒç›Šæš´éœ² = 377.6 + 280 = 657.6ä¸‡

é£æ ¼å æ¯”:
  å‡è¡¡å æ¯” = (377.6 / 657.6) Ã— 100% = 57.4%
  ç§‘æŠ€æˆé•¿å æ¯” = (280 / 657.6) Ã— 100% = 42.6%
```

### 4.5 è¯¦ç»†è¡¨æ ¼æƒç›Šæš´éœ²å æ¯”

**å…¬å¼**: æƒç›Šæš´éœ²å æ¯” = (è¯¥æŒä»“æƒç›Šæš´éœ²é‡‘é¢ / äº§å“å‡€èµ„äº§) Ã— 100%

**æ³¨æ„**: è¿™ä¸ªå æ¯”ä¸é£æ ¼å æ¯”ä¸åŒ!

**ä»£ç å®ç°**:
```javascript
filteredData.forEach(row => {
    // ä½¿ç”¨äº§å“å‡€èµ„äº§è®¡ç®—
    row.equityExposureRatio = row.productNetAsset > 0
        ? (row.equityExposure / row.productNetAsset * 100)
        : 0;
});
```

**è®¡ç®—ç¤ºä¾‹**:
```
æ‹›å•†å“è´¨å‘ç°æ··åˆåŸºé‡‘:
  æŒä»“é‡‘é¢: 2,760,134.15å…ƒ
  æƒç›Šä»“ä½: 100%
  æƒç›Šæš´éœ²é‡‘é¢: 2,760,134.15å…ƒ
  äº§å“å‡€èµ„äº§: 12,827,412.85å…ƒ
  æƒç›Šæš´éœ²å æ¯” = (2,760,134.15 / 12,827,412.85) Ã— 100% = 21.51%
```

### 4.6 æ™ºèƒ½åŸºé‡‘æ£€æµ‹è§„åˆ™

**æ£€æµ‹æ¡ä»¶**(å¿…é¡»åŒæ—¶æ»¡è¶³):
```
æ¡ä»¶1: æ–°ç‰ˆèµ„äº§å¤§ç±» === 'å…¬å‹ŸåŸºé‡‘'
æ¡ä»¶2: æ–°ç‰ˆèµ„äº§å°ç±» âˆˆ [å…¬å‹Ÿè‚¡ç¥¨åŸºé‡‘, æ™®é€šè‚¡ç¥¨å‹åŸºé‡‘, å…¬å‹Ÿæ··åˆåŸºé‡‘,
                      åè‚¡æ··åˆå‹åŸºé‡‘, çµæ´»é…ç½®å‹åŸºé‡‘, äºŒçº§å…¬å‹Ÿå€ºåˆ¸åŸºé‡‘,
                      æ··åˆå€ºåˆ¸å‹äºŒçº§åŸºé‡‘, å…¶ä»–å…¬å‹ŸåŸºé‡‘, è¢«åŠ¨æŒ‡æ•°å‹åŸºé‡‘,
                      å›½é™…(QDII)è¢«åŠ¨æŒ‡æ•°å‹è‚¡ç¥¨åŸºé‡‘]
æ¡ä»¶3: matchKey âˆ‰ fundClassifications (æœªåœ¨æ•°æ®åº“ä¸­)
```

**é»˜è®¤æƒç›Šä»“ä½è§„åˆ™**:
```javascript
const FUND_EQUITY_SUBCLASS_RULES = {
    'å…¬å‹Ÿè‚¡ç¥¨åŸºé‡‘': { defaultEquity: 100 },
    'æ™®é€šè‚¡ç¥¨å‹åŸºé‡‘': { defaultEquity: 100 },
    'å…¬å‹Ÿæ··åˆåŸºé‡‘': { defaultEquity: 100 },
    'åè‚¡æ··åˆå‹åŸºé‡‘': { defaultEquity: 80 },
    'çµæ´»é…ç½®å‹åŸºé‡‘': { defaultEquity: 80 },
    'äºŒçº§å…¬å‹Ÿå€ºåˆ¸åŸºé‡‘': { defaultEquity: 20 },
    'æ··åˆå€ºåˆ¸å‹äºŒçº§åŸºé‡‘': { defaultEquity: 20 },
    'å…¶ä»–å…¬å‹ŸåŸºé‡‘': { defaultEquity: 100 },
    'è¢«åŠ¨æŒ‡æ•°å‹åŸºé‡‘': { defaultEquity: 100 },
    'å›½é™…(QDII)è¢«åŠ¨æŒ‡æ•°å‹è‚¡ç¥¨åŸºé‡‘': { defaultEquity: 100 }
};
```

**æ£€æµ‹ç¤ºä¾‹**:
```
æ£€æµ‹åˆ°:
  èµ„äº§ç®€ç§°: "æ–°åŸºé‡‘ABC"
  å¤–éƒ¨ä»£ç : "999999.OF"
  æ–°ç‰ˆèµ„äº§å¤§ç±»: "å…¬å‹ŸåŸºé‡‘"
  æ–°ç‰ˆèµ„äº§å°ç±»: "å…¬å‹Ÿè‚¡ç¥¨åŸºé‡‘"

åˆ¤æ–­:
  âœ“ æ˜¯å…¬å‹ŸåŸºé‡‘
  âœ“ å°ç±»åœ¨æ£€æµ‹èŒƒå›´å†…
  âœ“ "999999.OF"ä¸åœ¨fundClassificationsä¸­

ç»“æœ: è¯†åˆ«ä¸ºæœªåˆ†ç±»åŸºé‡‘,é»˜è®¤æƒç›Šä»“ä½100%
```

---

## 5. åŠŸèƒ½å®ç°è¯¦è§£

### 5.1 æ–‡ä»¶ä¸Šä¼ æ¨¡å—

**HTMLç»“æ„**:
```html
<div class="upload-area" id="uploadArea">
    <p>ğŸ“Š æ‹–æ‹½Excelæ–‡ä»¶åˆ°æ­¤å¤„æˆ–ç‚¹å‡»ä¸Šä¼ </p>
    <button class="upload-btn" onclick="document.getElementById('fileInput').click()">
        é€‰æ‹©æ–‡ä»¶
    </button>
    <input type="file" id="fileInput" class="file-input" accept=".xlsx,.xls" />
</div>
```

**JavaScriptå®ç°**:
```javascript
// è®¾ç½®æ–‡ä»¶ä¸Šä¼ 
function setupFileUpload() {
    const fileInput = document.getElementById('fileInput');
    const uploadArea = document.getElementById('uploadArea');

    // ç‚¹å‡»ä¸Šä¼ 
    fileInput.addEventListener('change', handleFileUpload);

    // æ‹–æ‹½ä¸Šä¼ 
    uploadArea.addEventListener('dragover', (e) => {
        e.preventDefault();
        uploadArea.classList.add('dragover');
    });

    uploadArea.addEventListener('dragleave', () => {
        uploadArea.classList.remove('dragover');
    });

    uploadArea.addEventListener('drop', (e) => {
        e.preventDefault();
        uploadArea.classList.remove('dragover');
        const files = e.dataTransfer.files;
        if (files.length > 0) {
            handleFileUpload({ target: { files: files } });
        }
    });
}

// å¤„ç†æ–‡ä»¶ä¸Šä¼ 
function handleFileUpload(event) {
    const file = event.target.files[0];
    if (!file) return;

    const loading = document.getElementById('loading');
    loading.classList.add('show');

    const reader = new FileReader();
    reader.onload = function(e) {
        try {
            // è§£æExcel
            const data = new Uint8Array(e.target.result);
            const workbook = XLSX.read(data, { type: 'array' });
            const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
            const jsonData = XLSX.utils.sheet_to_json(firstSheet);

            holdingData = jsonData;
            processData(); // å¤„ç†æ•°æ®

            loading.classList.remove('show');
            document.getElementById('uploadResult').innerHTML =
                `<div class="success">âœ… æˆåŠŸä¸Šä¼ å¹¶å¤„ç†äº† ${jsonData.length} æ¡æŒä»“æ•°æ®</div>`;
        } catch (error) {
            loading.classList.remove('show');
            document.getElementById('uploadResult').innerHTML =
                `<div class="error">âŒ æ–‡ä»¶å¤„ç†å¤±è´¥: ${error.message}</div>`;
        }
    };
    reader.readAsArrayBuffer(file);
}
```

### 5.2 åŸºé‡‘åˆ†ç±»ç®¡ç†æ¨¡å—

**HTMLç»“æ„**:
```html
<div class="fund-settings">
    <div>
        <!-- å·¦ä¾§:åŸºé‡‘åˆ—è¡¨ -->
        <div class="fund-list" id="fundList">
            <!-- åŠ¨æ€ç”ŸæˆåŸºé‡‘é¡¹ -->
        </div>
    </div>
    <div class="add-fund-form">
        <!-- å³ä¾§:æ·»åŠ è¡¨å• -->
        <div class="form-group">
            <label>èµ„äº§å°ç±»</label>
            <select id="newAssetClass">
                <option value="äºŒçº§å…¬å‹Ÿå€ºåˆ¸åŸºé‡‘">äºŒçº§å…¬å‹Ÿå€ºåˆ¸åŸºé‡‘</option>
                <option value="å…¬å‹Ÿè‚¡ç¥¨åŸºé‡‘">å…¬å‹Ÿè‚¡ç¥¨åŸºé‡‘</option>
                <!-- æ›´å¤šé€‰é¡¹ -->
            </select>
        </div>
        <div class="form-group">
            <label>èµ„äº§ç®€ç§°</label>
            <input type="text" id="newAssetName" placeholder="è¾“å…¥åŸºé‡‘åç§°" />
        </div>
        <div class="form-group">
            <label>é£æ ¼</label>
            <select id="newStyle">
                <option value="å‡è¡¡">å‡è¡¡</option>
                <option value="ç§‘æŠ€æˆé•¿">ç§‘æŠ€æˆé•¿</option>
                <option value="å‘¨æœŸ">å‘¨æœŸ</option>
                <option value="çº¢åˆ©">çº¢åˆ©</option>
                <option value="ä»·å€¼">ä»·å€¼</option>
            </select>
        </div>
        <div class="form-group">
            <label>æƒç›Šä»“ä½</label>
            <input type="number" id="newEquityPosition"
                   placeholder="è¾“å…¥æƒç›Šä»“ä½ (0-100)" min="0" max="100" />
        </div>
        <button class="btn btn-primary" onclick="addFund()">æ·»åŠ åŸºé‡‘</button>
    </div>
</div>
```

**JavaScriptå‡½æ•°**:
```javascript
// æ¸²æŸ“åŸºé‡‘åˆ—è¡¨
function renderFundList() {
    const fundList = document.getElementById('fundList');
    fundList.innerHTML = '';

    Object.keys(fundClassifications).forEach(fundKey => {
        const fund = fundClassifications[fundKey];
        const fundItem = document.createElement('div');
        fundItem.className = 'fund-item';

        fundItem.innerHTML = `
            <input type="text" value="${fundKey}" readonly style="background: #f9f9f9;" />
            <select onchange="updateFund('${fundKey}', 'assetClass', this.value)">
                <option value="äºŒçº§å…¬å‹Ÿå€ºåˆ¸åŸºé‡‘" ${fund.assetClass === 'äºŒçº§å…¬å‹Ÿå€ºåˆ¸åŸºé‡‘' ? 'selected' : ''}>äºŒçº§å…¬å‹Ÿå€ºåˆ¸åŸºé‡‘</option>
                <option value="å…¬å‹Ÿè‚¡ç¥¨åŸºé‡‘" ${fund.assetClass === 'å…¬å‹Ÿè‚¡ç¥¨åŸºé‡‘' ? 'selected' : ''}>å…¬å‹Ÿè‚¡ç¥¨åŸºé‡‘</option>
                <!-- æ›´å¤šé€‰é¡¹ -->
            </select>
            <select onchange="updateFund('${fundKey}', 'style', this.value)">
                <option value="å‡è¡¡" ${fund.style === 'å‡è¡¡' ? 'selected' : ''}>å‡è¡¡</option>
                <option value="ç§‘æŠ€æˆé•¿" ${fund.style === 'ç§‘æŠ€æˆé•¿' ? 'selected' : ''}>ç§‘æŠ€æˆé•¿</option>
                <option value="å‘¨æœŸ" ${fund.style === 'å‘¨æœŸ' ? 'selected' : ''}>å‘¨æœŸ</option>
                <option value="çº¢åˆ©" ${fund.style === 'çº¢åˆ©' ? 'selected' : ''}>çº¢åˆ©</option>
                <option value="ä»·å€¼" ${fund.style === 'ä»·å€¼' ? 'selected' : ''}>ä»·å€¼</option>
            </select>
            <input type="number" value="${fund.equityPosition}" min="0" max="100"
                   onchange="updateFund('${fundKey}', 'equityPosition', parseFloat(this.value))" />
            <button class="btn btn-danger" onclick="deleteFund('${fundKey}')">åˆ é™¤</button>
        `;

        fundList.appendChild(fundItem);
    });
}

// æ·»åŠ åŸºé‡‘
function addFund() {
    const assetClass = document.getElementById('newAssetClass').value;
    const assetName = document.getElementById('newAssetName').value.trim();
    const style = document.getElementById('newStyle').value;
    const equityPosition = parseFloat(document.getElementById('newEquityPosition').value);

    // éªŒè¯
    if (!assetName) {
        alert('è¯·è¾“å…¥åŸºé‡‘åç§°');
        return;
    }
    if (isNaN(equityPosition) || equityPosition < 0 || equityPosition > 100) {
        alert('è¯·è¾“å…¥æœ‰æ•ˆçš„æƒç›Šä»“ä½ (0-100)');
        return;
    }
    if (fundClassifications[assetName]) {
        alert('è¯¥åŸºé‡‘å·²å­˜åœ¨');
        return;
    }

    // æ·»åŠ 
    fundClassifications[assetName] = {
        assetClass: assetClass,
        style: style,
        equityPosition: equityPosition
    };

    saveFundClassifications(); // ä¿å­˜åˆ°LocalStorage

    // æ¸…ç©ºè¡¨å•
    document.getElementById('newAssetName').value = '';
    document.getElementById('newEquityPosition').value = '';

    renderFundList();
    if (holdingData.length > 0) {
        processData(); // é‡æ–°è®¡ç®—
    }
}

// æ›´æ–°åŸºé‡‘
function updateFund(fundKey, property, value) {
    if (fundClassifications[fundKey]) {
        fundClassifications[fundKey][property] = value;
        saveFundClassifications();
        if (holdingData.length > 0) {
            processData();
        }
    }
}

// åˆ é™¤åŸºé‡‘
function deleteFund(fundKey) {
    if (confirm(`ç¡®å®šè¦åˆ é™¤ ${fundKey} å—?`)) {
        delete fundClassifications[fundKey];
        saveFundClassifications();
        renderFundList();
        if (holdingData.length > 0) {
            processData();
        }
    }
}
```

### 5.3 æ™ºèƒ½åŸºé‡‘æ£€æµ‹æ¨¡å—

**HTMLç»“æ„**:
```html
<!-- æ£€æµ‹çŠ¶æ€åŒºåŸŸ -->
<div class="section" id="fundDetectionStatusSection" style="display: none;">
    <div id="fundDetectionContent"></div>
</div>

<!-- æœªåˆ†ç±»åŸºé‡‘åŒºåŸŸ -->
<div class="section" id="unclassifiedFundsSection" style="display: none;">
    <h2>âš ï¸ å‘ç°æœªåˆ†ç±»åŸºé‡‘</h2>
    <p style="color: #ff6b35;">
        åœ¨æŒä»“è¡¨ä¸­æ£€æµ‹åˆ°ä»¥ä¸‹å«æƒç›ŠåŸºé‡‘å°šæœªåˆ†ç±»,è¯·è®¾ç½®å…¶é£æ ¼å’Œæƒç›Šä»“ä½åæ‰¹é‡æ·»åŠ :
    </p>
    <div class="unclassified-funds-container">
        <div style="display: flex; gap: 15px; margin-bottom: 15px;">
            <button class="btn btn-primary" onclick="batchAddUnclassifiedFunds()">
                ğŸ“¥ æ‰¹é‡æ·»åŠ æ‰€æœ‰åŸºé‡‘
            </button>
            <button class="btn" style="background: #6b7280; color: white;"
                    onclick="hideUnclassifiedFunds()">
                âŒ æš‚æ—¶éšè—
            </button>
        </div>
        <div class="unclassified-funds-list" id="unclassifiedFundsList"></div>
    </div>
</div>
```

**JavaScriptå®ç°**:
```javascript
// åœ¨processData()ä¸­æ£€æµ‹æœªåˆ†ç±»åŸºé‡‘
function processData() {
    // ... å‰é¢çš„ä»£ç  ...

    const detectedUnclassifiedFunds = new Set();
    unclassifiedFunds = [];

    holdingData.forEach(row => {
        const assetClass = normalizeText(row['æ–°ç‰ˆèµ„äº§å¤§ç±»']);
        const assetSubClass = normalizeText(row['æ–°ç‰ˆèµ„äº§å°ç±»']);
        const matchKey = getFundMatchKey(row);
        const classification = fundClassifications[matchKey];
        const equitySubclassRule = FUND_EQUITY_SUBCLASS_RULES[assetSubClass];

        // æ£€æµ‹æ¡ä»¶
        if (!classification &&
            assetClass === 'å…¬å‹ŸåŸºé‡‘' &&
            equitySubclassRule) {

            if (!detectedUnclassifiedFunds.has(matchKey)) {
                detectedUnclassifiedFunds.add(matchKey);
                unclassifiedFunds.push({
                    assetName: normalizeText(row['èµ„äº§ç®€ç§°']),
                    matchKey: matchKey,
                    externalCode: normalizeText(row['å¤–éƒ¨ä»£ç ']),
                    assetSubClass: assetSubClass,
                    style: '',
                    equityPosition: equitySubclassRule.defaultEquity
                });
            }
        }
    });

    // ... åé¢çš„ä»£ç  ...

    renderFundDetectionStatus();
    renderUnclassifiedFunds();
}

// æ¸²æŸ“æœªåˆ†ç±»åŸºé‡‘åˆ—è¡¨
function renderUnclassifiedFunds() {
    const section = document.getElementById('unclassifiedFundsSection');
    const fundsList = document.getElementById('unclassifiedFundsList');

    if (unclassifiedFunds.length === 0) {
        section.style.display = 'none';
        return;
    }

    section.style.display = 'block';

    let html = `
        <div class="unclassified-fund-header">
            <div>åŸºé‡‘åç§°</div>
            <div>èµ„äº§ç±»å‹</div>
            <div>é£æ ¼</div>
            <div>æƒç›Šä»“ä½</div>
            <div>æ“ä½œ</div>
        </div>
    `;

    unclassifiedFunds.forEach((fund, index) => {
        html += `
            <div class="unclassified-fund-item">
                <div class="fund-name">${fund.assetName}</div>
                <div class="asset-type">${fund.assetSubClass}</div>
                <select id="unclassifiedStyle-${index}"
                        onchange="updateUnclassifiedFund(${index}, 'style', this.value)">
                    <option value="">è¯·é€‰æ‹©é£æ ¼</option>
                    <option value="çº¢åˆ©">çº¢åˆ©</option>
                    <option value="å‡è¡¡">å‡è¡¡</option>
                    <option value="ç§‘æŠ€æˆé•¿">ç§‘æŠ€æˆé•¿</option>
                    <option value="å‘¨æœŸ">å‘¨æœŸ</option>
                    <option value="ä»·å€¼">ä»·å€¼</option>
                </select>
                <input type="number" value="${fund.equityPosition}" min="0" max="100"
                       onchange="updateUnclassifiedFund(${index}, 'equityPosition', parseFloat(this.value))" />
                <button class="batch-add-individual"
                        onclick="addSingleUnclassifiedFund(${index})"
                        ${!fund.style ? 'disabled' : ''}>
                    æ·»åŠ 
                </button>
            </div>
        `;
    });

    fundsList.innerHTML = html;
}

// æ‰¹é‡æ·»åŠ æœªåˆ†ç±»åŸºé‡‘
function batchAddUnclassifiedFunds() {
    // æ£€æŸ¥é£æ ¼æ˜¯å¦éƒ½å·²è®¾ç½®
    const unsetFunds = unclassifiedFunds.filter(fund => !fund.style);
    if (unsetFunds.length > 0) {
        alert(`è¿˜æœ‰${unsetFunds.length}ä¸ªåŸºé‡‘æœªè®¾ç½®é£æ ¼,è¯·è®¾ç½®åå†æ‰¹é‡æ·»åŠ `);
        return;
    }

    // æ£€æŸ¥æƒç›Šä»“ä½
    const invalidFunds = unclassifiedFunds.filter(fund =>
        isNaN(fund.equityPosition) || fund.equityPosition < 0 || fund.equityPosition > 100
    );
    if (invalidFunds.length > 0) {
        alert('å­˜åœ¨æ— æ•ˆçš„æƒç›Šä»“ä½è®¾ç½®,è¯·æ£€æŸ¥åå†æ‰¹é‡æ·»åŠ ');
        return;
    }

    if (!confirm(`ç¡®å®šè¦æ‰¹é‡æ·»åŠ ${unclassifiedFunds.length}ä¸ªåŸºé‡‘åˆ°åˆ†ç±»æ•°æ®åº“å—?`)) {
        return;
    }

    // æ‰¹é‡æ·»åŠ (ä½¿ç”¨matchKeyä½œä¸ºé”®!)
    let addedCount = 0;
    unclassifiedFunds.forEach(fund => {
        if (!fundClassifications[fund.matchKey]) {
            fundClassifications[fund.matchKey] = {
                assetClass: fund.assetSubClass,
                style: fund.style,
                equityPosition: fund.equityPosition
            };
            addedCount++;
        }
    });

    if (addedCount > 0) {
        saveFundClassifications();
    }

    unclassifiedFunds = [];
    renderFundList();
    processData();

    alert(`æˆåŠŸæ‰¹é‡æ·»åŠ äº†${addedCount}ä¸ªåŸºé‡‘åˆ°åˆ†ç±»æ•°æ®åº“`);
}
```

### 5.4 æ•°æ®å¯è§†åŒ–æ¨¡å—

#### 5.4.1 çŸ©é˜µæ±‡æ€»è¡¨æ ¼
```javascript
function renderMatrixTable() {
    const matrixTable = document.getElementById('matrixTable');

    // è·å–æ‰€æœ‰é£æ ¼å¹¶æ’åº(çº¢åˆ©ä¼˜å…ˆ)
    const styleOrder = ['çº¢åˆ©', 'å‡è¡¡', 'ç§‘æŠ€æˆé•¿', 'å‘¨æœŸ', 'ä»·å€¼'];
    const allStyles = new Set();
    Object.values(analysisResults).forEach(product => {
        Object.keys(product).forEach(style => allStyles.add(style));
    });
    const styles = Array.from(allStyles).sort((a, b) => {
        const indexA = styleOrder.indexOf(a);
        const indexB = styleOrder.indexOf(b);
        if (indexA === -1 && indexB === -1) return a.localeCompare(b);
        if (indexA === -1) return 1;
        if (indexB === -1) return -1;
        return indexA - indexB;
    });

    // åˆ›å»ºè¡¨å¤´
    let headerHtml = '<tr><th>äº§å“åç§°</th>';
    styles.forEach(style => {
        headerHtml += `<th>${style}</th>`;
    });
    headerHtml += '</tr>';

    // åˆ›å»ºè¡¨æ ¼è¡Œ
    let bodyHtml = '';
    Array.from(selectedProducts).forEach(productName => {
        const product = analysisResults[productName];
        let rowHtml = `<tr><td class="product-name">${productName}</td>`;

        styles.forEach(style => {
            const data = product[style];
            if (data) {
                if (matrixDisplayType === 'amount') {
                    // é‡‘é¢æ¨¡å¼:å››èˆäº”å…¥åˆ°æ•´æ•°
                    rowHtml += `<td class="amount-cell">${(data.amount / 10000).toFixed(0)}ä¸‡</td>`;
                } else {
                    // å æ¯”æ¨¡å¼:å››èˆäº”å…¥åˆ°æ•´æ•°,ä¸ä¿ç•™å°æ•°
                    rowHtml += `<td class="percentage-cell">${Math.round(data.percentage)}%</td>`;
                }
            } else {
                rowHtml += `<td class="zero-cell">-</td>`;
            }
        });

        rowHtml += '</tr>';
        bodyHtml += rowHtml;
    });

    matrixTable.innerHTML = `
        <thead>${headerHtml}</thead>
        <tbody>${bodyHtml}</tbody>
    `;
}
```

#### 5.4.2 äº§å“å¡ç‰‡ä¸ç¯å½¢å›¾
```javascript
function renderProductCards() {
    const resultsGrid = document.getElementById('resultsGrid');
    resultsGrid.innerHTML = '';

    Array.from(selectedProducts).forEach(productName => {
        const product = analysisResults[productName];
        const productCard = document.createElement('div');
        productCard.className = 'product-card';

        // æ’åºé£æ ¼(çº¢åˆ©ä¼˜å…ˆ)
        const styleOrder = ['çº¢åˆ©', 'å‡è¡¡', 'ç§‘æŠ€æˆé•¿', 'å‘¨æœŸ', 'ä»·å€¼'];
        const sortedStyles = Object.keys(product).sort((a, b) => {
            const indexA = styleOrder.indexOf(a);
            const indexB = styleOrder.indexOf(b);
            if (indexA === -1 && indexB === -1) return a.localeCompare(b);
            if (indexA === -1) return 1;
            if (indexB === -1) return -1;
            return indexA - indexB;
        });

        let styleItemsHtml = '';
        sortedStyles.forEach(style => {
            const data = product[style];
            styleItemsHtml += `
                <div class="style-item">
                    <span class="style-name">${style}</span>
                    <span class="style-amount">${(data.amount / 10000).toFixed(0)}ä¸‡</span>
                    <span class="style-percentage">${Math.round(data.percentage)}%</span>
                </div>
            `;
        });

        productCard.innerHTML = `
            <h3>${productName}</h3>
            ${styleItemsHtml}
            <div class="chart-container">
                <canvas id="chart-${productName.replace(/[^a-zA-Z0-9]/g, '')}"></canvas>
            </div>
        `;

        resultsGrid.appendChild(productCard);

        // å»¶è¿Ÿåˆ›å»ºå›¾è¡¨
        setTimeout(() => createChart(productName, product), 100);
    });
}

function createChart(productName, data) {
    const canvasId = `chart-${productName.replace(/[^a-zA-Z0-9]/g, '')}`;
    const canvas = document.getElementById(canvasId);
    if (!canvas) return;

    const ctx = canvas.getContext('2d');
    const labels = Object.keys(data);
    const values = labels.map(label => data[label].percentage);
    const colors = [
        '#667eea', '#764ba2', '#f093fb', '#f5576c', '#4facfe',
        '#43e97b', '#fa709a', '#fee140', '#ff9a9e', '#a8edea'
    ];

    new Chart(ctx, {
        type: 'doughnut',
        data: {
            labels: labels,
            datasets: [{
                data: values,
                backgroundColor: colors.slice(0, labels.length),
                borderWidth: 2,
                borderColor: '#fff'
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'bottom',
                    labels: {
                        padding: 20,
                        usePointStyle: true
                    }
                }
            }
        }
    });
}
```

#### 5.4.3 è¯¦ç»†æ•°æ®è¡¨æ ¼
```javascript
function renderDetailTable(data) {
    const tbody = document.getElementById('detailTableBody');
    tbody.innerHTML = '';

    // ç­›é€‰:åªæ˜¾ç¤ºé€‰ä¸­äº§å“
    const filteredData = data.filter(row => selectedProducts.has(row.productName));

    // è®¡ç®—æƒç›Šæš´éœ²å æ¯”
    filteredData.forEach(row => {
        row.equityExposureRatio = row.productNetAsset > 0
            ? (row.equityExposure / row.productNetAsset * 100)
            : 0;
    });

    // æ’åº:äº§å“åâ†’é£æ ¼â†’æƒç›Šæš´éœ²å æ¯”(é™åº)
    filteredData.sort((a, b) => {
        if (a.productName < b.productName) return -1;
        if (a.productName > b.productName) return 1;
        if (a.style < b.style) return -1;
        if (a.style > b.style) return 1;
        return b.equityExposureRatio - a.equityExposureRatio;
    });

    filteredData.forEach(row => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
            <td>${row.productName}</td>
            <td>${row.assetName}</td>
            <td>${row.assetClass}</td>
            <td>${row.style}</td>
            <td>${row.equityPosition}%</td>
            <td>${(row.holdingAmount / 10000).toFixed(0)}ä¸‡</td>
            <td>${(row.equityExposure / 10000).toFixed(0)}ä¸‡</td>
            <td>${row.equityExposureRatio.toFixed(2)}%</td>
        `;
        tbody.appendChild(tr);
    });
}
```

### 5.5 æ•°æ®æŒä¹…åŒ–æ¨¡å—

```javascript
// å­˜å‚¨é”®
const STORAGE_KEY = 'fund_classifications_data';

// åŠ è½½
function loadFundClassifications() {
    try {
        const savedData = localStorage.getItem(STORAGE_KEY);
        if (savedData) {
            return JSON.parse(savedData);
        }
    } catch (error) {
        console.warn('åŠ è½½ä¿å­˜çš„åŸºé‡‘åˆ†ç±»æ•°æ®å¤±è´¥:', error);
    }
    return { ...defaultFundClassifications };
}

// ä¿å­˜
function saveFundClassifications() {
    try {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(fundClassifications));
        return true;
    } catch (error) {
        console.error('ä¿å­˜åŸºé‡‘åˆ†ç±»æ•°æ®å¤±è´¥:', error);
        return false;
    }
}

// å¯¼å‡ºJSON
function exportFundData() {
    const dataToExport = {
        version: '1.1.0',
        exportTime: new Date().toISOString(),
        fundClassifications: fundClassifications,
        totalFunds: Object.keys(fundClassifications).length
    };

    const dataStr = JSON.stringify(dataToExport, null, 2);
    const dataBlob = new Blob([dataStr], { type: 'application/json' });

    const link = document.createElement('a');
    link.href = URL.createObjectURL(dataBlob);
    link.download = `åŸºé‡‘åˆ†ç±»æ•°æ®_${new Date().toISOString().split('T')[0]}.json`;
    link.click();
}

// å¯¼å…¥JSON
function importFundData(event) {
    const file = event.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = function(e) {
        try {
            const importedData = JSON.parse(e.target.result);

            if (!importedData.fundClassifications) {
                alert('å¯¼å…¥æ–‡ä»¶æ ¼å¼ä¸æ­£ç¡®');
                return;
            }

            if (confirm(`ç¡®å®šè¦å¯¼å…¥${Object.keys(importedData.fundClassifications).length}ä¸ªåŸºé‡‘åˆ†ç±»æ•°æ®å—?`)) {
                fundClassifications = importedData.fundClassifications;
                saveFundClassifications();
                renderFundList();
                if (holdingData.length > 0) {
                    processData();
                }
                alert(`æˆåŠŸå¯¼å…¥${Object.keys(fundClassifications).length}ä¸ªåŸºé‡‘åˆ†ç±»æ•°æ®!`);
            }
        } catch (error) {
            alert('å¯¼å…¥æ•°æ®å¤±è´¥,è¯·æ£€æŸ¥æ–‡ä»¶æ ¼å¼');
        }
    };
    reader.readAsText(file);
    event.target.value = '';
}
```

---

## 6. UIç•Œé¢è§„èŒƒ

### 6.1 é¢œè‰²ç³»ç»Ÿ
```css
:root {
    --primary-color: #667eea;        /* ä¸»è‰² */
    --secondary-color: #764ba2;      /* æ¬¡è‰² */
    --success-color: #16a34a;        /* æˆåŠŸ */
    --error-color: #ef4444;          /* é”™è¯¯ */
    --warning-color: #ff6b35;        /* è­¦å‘Š */
    --info-color: #0ea5e9;           /* ä¿¡æ¯ */
    --background: #f5f5f7;           /* èƒŒæ™¯ */
    --card-bg: #ffffff;              /* å¡ç‰‡ */
    --border-color: #e2e8f0;         /* è¾¹æ¡† */
}
```

### 6.2 å…³é”®CSSæ ·å¼
```css
/* æ¸å˜æ ‡é¢˜ */
.header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 30px;
    border-radius: 15px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
}

/* ä¸Šä¼ åŒºåŸŸ */
.upload-area {
    border: 2px dashed #667eea;
    border-radius: 10px;
    padding: 40px;
    text-align: center;
    background: #f8f9ff;
    transition: all 0.3s ease;
}

.upload-area:hover {
    border-color: #5a67d8;
    background: #f0f2ff;
}

/* åŸºé‡‘åˆ—è¡¨é¡¹(5åˆ—ç½‘æ ¼) */
.fund-item {
    display: grid;
    grid-template-columns: 2fr 1fr 1fr 1fr 60px;
    gap: 15px;
    padding: 15px;
    border-bottom: 1px solid #e2e8f0;
}

/* çŸ©é˜µè¡¨æ ¼ */
.matrix-table th {
    background: #667eea;
    color: white;
    padding: 12px;
    text-align: center;
}

.matrix-table .product-name {
    background: #f8f9ff;
    font-weight: 600;
    text-align: left;
    padding-left: 15px;
}

.matrix-table .amount-cell {
    color: #667eea;
    font-weight: 600;
}

.matrix-table .percentage-cell {
    color: #16a34a;
    font-weight: 600;
}

/* æœªåˆ†ç±»åŸºé‡‘é¡¹ */
.unclassified-fund-item {
    display: grid;
    grid-template-columns: 2fr 1fr 1fr 1fr 80px;
    gap: 15px;
    padding: 15px;
    background: white;
    border-radius: 8px;
    margin-bottom: 10px;
    border: 1px solid #e2e8f0;
}
```

### 6.3 å“åº”å¼è®¾è®¡
```css
@media (max-width: 768px) {
    .fund-settings {
        grid-template-columns: 1fr;
    }

    .fund-item,
    .unclassified-fund-item {
        grid-template-columns: 1fr;
        gap: 10px;
    }

    .results-grid {
        grid-template-columns: 1fr;
    }
}
```

---

## 7. å®Œæ•´ä»£ç æ¡†æ¶

### 7.1 HTMLéª¨æ¶
```html
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŸºé‡‘åˆ†ç±»æ ‡ç­¾ç®¡ç†ç³»ç»Ÿ</title>
    <script src="xlsx.full.min.js"></script>
    <script src="chart.js"></script>
    <style>
        /* å¤åˆ¶fund_analysis.htmlä¸­çš„æ‰€æœ‰CSS */
    </style>
</head>
<body>
    <div class="container">
        <!-- 1. æ ‡é¢˜åŒºåŸŸ -->
        <div class="header">
            <h1>åŸºé‡‘åˆ†ç±»æ ‡ç­¾ç®¡ç†ç³»ç»Ÿ</h1>
            <p>ä¸Šä¼ æŒä»“æ˜ç»†è¡¨,è‡ªåŠ¨è®¡ç®—å„äº§å“ä¸åŒé£æ ¼çš„æƒç›Šæš´éœ²å æ¯”</p>
        </div>

        <!-- 2. æ–‡ä»¶ä¸Šä¼ åŒºåŸŸ -->
        <div class="section">
            <h2>ğŸ“ ä¸Šä¼ æŒä»“æ˜ç»†è¡¨</h2>
            <div class="upload-area" id="uploadArea">
                <p style="font-size: 1.2em; margin-bottom: 15px;">ğŸ“Š æ‹–æ‹½Excelæ–‡ä»¶åˆ°æ­¤å¤„æˆ–ç‚¹å‡»ä¸Šä¼ </p>
                <button class="upload-btn" onclick="document.getElementById('fileInput').click()">é€‰æ‹©æ–‡ä»¶</button>
                <input type="file" id="fileInput" class="file-input" accept=".xlsx,.xls" />
            </div>
            <div class="loading" id="loading"><p>ğŸ“Š æ­£åœ¨å¤„ç†æ•°æ®...</p></div>
            <div id="uploadResult"></div>
        </div>

        <!-- 3. åŸºé‡‘åˆ†ç±»è®¾ç½®åŒºåŸŸ -->
        <div class="section">
            <h2>âš™ï¸ åŸºé‡‘åˆ†ç±»è®¾ç½®</h2>
            <div class="fund-settings">
                <div>
                    <h3>å½“å‰åŸºé‡‘åˆ†ç±»</h3>
                    <div class="fund-list" id="fundList"></div>
                </div>
                <div class="add-fund-form">
                    <h3>æ·»åŠ æ–°åŸºé‡‘</h3>
                    <!-- è¡¨å•å­—æ®µ -->
                </div>
            </div>
        </div>

        <!-- 4. åŸºé‡‘æ£€æµ‹çŠ¶æ€åŒºåŸŸ -->
        <div class="section" id="fundDetectionStatusSection" style="display: none;">
            <div id="fundDetectionContent"></div>
        </div>

        <!-- 5. æœªåˆ†ç±»åŸºé‡‘åŒºåŸŸ -->
        <div class="section" id="unclassifiedFundsSection" style="display: none;">
            <h2>âš ï¸ å‘ç°æœªåˆ†ç±»åŸºé‡‘</h2>
            <div class="unclassified-funds-container">
                <div class="unclassified-funds-list" id="unclassifiedFundsList"></div>
            </div>
        </div>

        <!-- 6. åˆ†æç»“æœåŒºåŸŸ -->
        <div class="section">
            <h2>ğŸ“Š åˆ†æç»“æœ</h2>
            <div class="summary-stats" id="summaryStats"></div>
            <div class="matrix-section">
                <div class="matrix-controls">
                    <div class="filter-section">
                        <h4>äº§å“ç­›é€‰</h4>
                        <div class="filter-checkboxes" id="productFilters"></div>
                    </div>
                    <div class="toggle-section">
                        <h4>æ˜¾ç¤ºç±»å‹</h4>
                        <div class="toggle-buttons">
                            <button class="toggle-btn active" onclick="toggleMatrixDisplay('amount')">é‡‘é¢</button>
                            <button class="toggle-btn" onclick="toggleMatrixDisplay('percentage')">å æ¯”</button>
                        </div>
                    </div>
                </div>
                <table class="matrix-table" id="matrixTable"></table>
            </div>
            <div class="results-grid" id="resultsGrid"></div>
        </div>

        <!-- 7. è¯¦ç»†æ•°æ®è¡¨æ ¼ -->
        <div class="section">
            <h2>ğŸ“‹ è¯¦ç»†æ•°æ®</h2>
            <table class="data-table" id="detailTable">
                <thead>
                    <tr>
                        <th>äº§å“åç§°</th>
                        <th>åŸºé‡‘åç§°</th>
                        <th>èµ„äº§å°ç±»</th>
                        <th>é£æ ¼</th>
                        <th>æƒç›Šä»“ä½</th>
                        <th>æŒä»“é‡‘é¢</th>
                        <th>æƒç›Šæš´éœ²é‡‘é¢</th>
                        <th>æƒç›Šæš´éœ²å æ¯”</th>
                    </tr>
                </thead>
                <tbody id="detailTableBody"></tbody>
            </table>
        </div>
    </div>

    <script>
        /* æ‰€æœ‰JavaScriptä»£ç  */
    </script>
</body>
</html>
```

### 7.2 JavaScriptä¸»æµç¨‹
```javascript
// ========== 1. å…¨å±€å¸¸é‡å’Œå˜é‡ ==========
const defaultFundClassifications = {
    // 66ä¸ªé»˜è®¤åŸºé‡‘æ•°æ®
};

const STORAGE_KEY = 'fund_classifications_data';
const FUND_EQUITY_SUBCLASS_RULES = { /* ... */ };
const FUND_EQUITY_SUBCLASS_NAMES = Object.keys(FUND_EQUITY_SUBCLASS_RULES);

let fundClassifications = {};
let holdingData = [];
let analysisResults = {};
let selectedProducts = new Set();
let matrixDisplayType = 'amount';
let unclassifiedFunds = [];

// ========== 2. åˆå§‹åŒ– ==========
document.addEventListener('DOMContentLoaded', function() {
    fundClassifications = loadFundClassifications();
    renderFundList();
    setupFileUpload();
});

// ========== 3. å·¥å…·å‡½æ•° ==========
function normalizeText(value) {
    if (value === null || value === undefined) return '';
    return String(value).trim();
}

function getFundMatchKey(row) {
    // å®ç°åŒ¹é…é”®é€»è¾‘
}

// ========== 4. æ–‡ä»¶ä¸Šä¼  ==========
function setupFileUpload() { /* ... */ }
function handleFileUpload(event) { /* ... */ }

// ========== 5. æ•°æ®å¤„ç†(æ ¸å¿ƒ) ==========
function processData() {
    // æ­¥éª¤1: è®¡ç®—å‡€èµ„äº§
    // æ­¥éª¤2: æ£€æµ‹æœªåˆ†ç±»åŸºé‡‘
    // æ­¥éª¤3: è®¡ç®—æƒç›Šæš´éœ²
    // æ­¥éª¤4: è®¡ç®—å æ¯”
    // æ­¥éª¤5: æ¸²æŸ“ç»“æœ
}

// ========== 6. åŸºé‡‘ç®¡ç† ==========
function renderFundList() { /* ... */ }
function addFund() { /* ... */ }
function updateFund(fundKey, property, value) { /* ... */ }
function deleteFund(fundKey) { /* ... */ }

// ========== 7. æ™ºèƒ½æ£€æµ‹ ==========
function renderUnclassifiedFunds() { /* ... */ }
function updateUnclassifiedFund(index, property, value) { /* ... */ }
function addSingleUnclassifiedFund(index) { /* ... */ }
function batchAddUnclassifiedFunds() { /* ... */ }

// ========== 8. å¯è§†åŒ–æ¸²æŸ“ ==========
function renderResults() {
    renderSummaryStats();
    renderProductFilters();
    renderMatrixTable();
    renderProductCards();
}

function renderSummaryStats() { /* ... */ }
function renderProductFilters() { /* ... */ }
function renderMatrixTable() { /* ... */ }
function renderProductCards() { /* ... */ }
function createChart(productName, data) { /* ... */ }
function renderDetailTable(data) { /* ... */ }

// ========== 9. äº¤äº’æ§åˆ¶ ==========
function toggleProductFilter(productName) { /* ... */ }
function toggleMatrixDisplay(type) { /* ... */ }
function selectAllProducts() { /* ... */ }
function deselectAllProducts() { /* ... */ }

// ========== 10. æ•°æ®æŒä¹…åŒ– ==========
function loadFundClassifications() { /* ... */ }
function saveFundClassifications() { /* ... */ }
function exportFundData() { /* ... */ }
function importFundData(event) { /* ... */ }
function resetToDefaults() { /* ... */ }
```

---

## 8. æµ‹è¯•éªŒè¯

### 8.1 åŠŸèƒ½æµ‹è¯•æ¸…å•
```
â–¡ æ–‡ä»¶ä¸Šä¼ 
  â–¡ ç‚¹å‡»ä¸Šä¼ æ­£å¸¸
  â–¡ æ‹–æ‹½ä¸Šä¼ æ­£å¸¸
  â–¡ ä¸Šä¼ æˆåŠŸæ˜¾ç¤ºè®°å½•æ•°
  â–¡ ä¸Šä¼ å¤±è´¥æ˜¾ç¤ºé”™è¯¯

â–¡ åŸºé‡‘ç®¡ç†
  â–¡ æ·»åŠ åŸºé‡‘æˆåŠŸ
  â–¡ ä¿®æ”¹åŸºé‡‘è‡ªåŠ¨ä¿å­˜
  â–¡ åˆ é™¤åŸºé‡‘ç¡®è®¤
  â–¡ è¡¨å•éªŒè¯æ­£ç¡®

â–¡ æ™ºèƒ½æ£€æµ‹
  â–¡ æ£€æµ‹åˆ°æœªåˆ†ç±»åŸºé‡‘
  â–¡ é»˜è®¤æƒç›Šä»“ä½æ­£ç¡®
  â–¡ æ‰¹é‡æ·»åŠ æˆåŠŸ
  â–¡ å•ä¸ªæ·»åŠ æˆåŠŸ

â–¡ æ•°æ®è®¡ç®—
  â–¡ å‡€èµ„äº§æ‰£é™¤æ­£å›è´­
  â–¡ æƒç›Šæš´éœ²è®¡ç®—æ­£ç¡®
  â–¡ é£æ ¼å æ¯”è®¡ç®—æ­£ç¡®
  â–¡ è¯¦ç»†è¡¨æ ¼å æ¯”æ­£ç¡®

â–¡ å¯è§†åŒ–
  â–¡ çŸ©é˜µè¡¨æ ¼æ˜¾ç¤ºæ­£ç¡®
  â–¡ é‡‘é¢/å æ¯”åˆ‡æ¢æ­£å¸¸
  â–¡ ç¯å½¢å›¾æ˜¾ç¤ºæ­£ç¡®
  â–¡ è¯¦ç»†è¡¨æ ¼æ’åºæ­£ç¡®

â–¡ äº§å“ç­›é€‰
  â–¡ å…¨é€‰/å…¨ä¸é€‰æ­£å¸¸
  â–¡ å•é€‰äº§å“æ­£å¸¸
  â–¡ ç­›é€‰åè¡¨æ ¼åŒæ­¥æ›´æ–°

â–¡ æ•°æ®æŒä¹…åŒ–
  â–¡ åˆ·æ–°é¡µé¢æ•°æ®ä¿ç•™
  â–¡ å¯¼å‡ºJSONæˆåŠŸ
  â–¡ å¯¼å…¥JSONæˆåŠŸ
```

### 8.2 è®¡ç®—éªŒè¯æµ‹è¯•ç”¨ä¾‹

**æµ‹è¯•ç”¨ä¾‹1: æ­£å›è´­æ‰£é™¤**
```
è¾“å…¥æ•°æ®:
  äº§å“A:
    - åŸºé‡‘A: 10,000,000å…ƒ
    - æ­£å›è´­: 5,000,000å…ƒ
    - ç°é‡‘: 2,000,000å…ƒ

é¢„æœŸç»“æœ:
  å‡€èµ„äº§ = 10,000,000 - 5,000,000 + 2,000,000 = 7,000,000å…ƒ
```

**æµ‹è¯•ç”¨ä¾‹2: æƒç›Šæš´éœ²è®¡ç®—**
```
è¾“å…¥æ•°æ®:
  åŸºé‡‘A(äºŒçº§å€ºåŸº):
    æŒä»“é‡‘é¢: 10,000,000å…ƒ
    æƒç›Šä»“ä½: 20%

é¢„æœŸç»“æœ:
  æƒç›Šæš´éœ² = 10,000,000 Ã— 0.2 = 2,000,000å…ƒ
```

**æµ‹è¯•ç”¨ä¾‹3: é£æ ¼å æ¯”è®¡ç®—**
```
è¾“å…¥æ•°æ®:
  äº§å“A:
    å‡è¡¡é£æ ¼æš´éœ²: 3,000,000å…ƒ
    ç§‘æŠ€æˆé•¿æš´éœ²: 2,000,000å…ƒ

é¢„æœŸç»“æœ:
  æ€»æš´éœ² = 5,000,000å…ƒ
  å‡è¡¡å æ¯” = 3,000,000 / 5,000,000 = 60%
  ç§‘æŠ€æˆé•¿å æ¯” = 2,000,000 / 5,000,000 = 40%
```

### 8.3 è¾¹ç•Œæµ‹è¯•
```
â–¡ ç©ºExcelæ–‡ä»¶
â–¡ æ— åŒ¹é…åŸºé‡‘çš„Excel
â–¡ å…¨éƒ¨æœªåˆ†ç±»åŸºé‡‘
â–¡ æƒç›Šä»“ä½ä¸º0
â–¡ æƒç›Šä»“ä½ä¸º100
â–¡ äº§å“åç§°ç‰¹æ®Šå­—ç¬¦
â–¡ åŸºé‡‘åç§°è¶…é•¿
```

---

## é™„å½•A: é»˜è®¤66ä¸ªåŸºé‡‘æ•°æ®

```javascript
const defaultFundClassifications = {
    "002361.OF": { "assetClass": "äºŒçº§å…¬å‹Ÿå€ºåˆ¸åŸºé‡‘", "style": "å‡è¡¡", "equityPosition": 20 },
    "000385.OF": { "assetClass": "äºŒçº§å…¬å‹Ÿå€ºåˆ¸åŸºé‡‘", "style": "å‡è¡¡", "equityPosition": 20 },
    "015805.OF": { "assetClass": "äºŒçº§å…¬å‹Ÿå€ºåˆ¸åŸºé‡‘", "style": "å‡è¡¡", "equityPosition": 20 },
    "016869.OF": { "assetClass": "äºŒçº§å…¬å‹Ÿå€ºåˆ¸åŸºé‡‘", "style": "å‡è¡¡", "equityPosition": 20 },
    "006466.OF": { "assetClass": "äºŒçº§å…¬å‹Ÿå€ºåˆ¸åŸºé‡‘", "style": "å‡è¡¡", "equityPosition": 20 },
    "110008.OF": { "assetClass": "äºŒçº§å…¬å‹Ÿå€ºåˆ¸åŸºé‡‘", "style": "å‡è¡¡", "equityPosition": 20 },
    "002351.OF": { "assetClass": "äºŒçº§å…¬å‹Ÿå€ºåˆ¸åŸºé‡‘", "style": "å‡è¡¡", "equityPosition": 20 },
    "013642.OF": { "assetClass": "å…¬å‹Ÿè‚¡ç¥¨åŸºé‡‘", "style": "ç§‘æŠ€æˆé•¿", "equityPosition": 100 },
    "011426.OF": { "assetClass": "å…¬å‹Ÿè‚¡ç¥¨åŸºé‡‘", "style": "å‘¨æœŸ", "equityPosition": 100 },
    "159338.SZ": { "assetClass": "å…¬å‹Ÿè‚¡ç¥¨åŸºé‡‘", "style": "å‡è¡¡", "equityPosition": 100 },
    "åæ³°æŸç‘çº¢åˆ©ETF ( 510880.SH )": { "assetClass": "å…¬å‹Ÿè‚¡ç¥¨åŸºé‡‘", "style": "çº¢åˆ©", "equityPosition": 100 },
    "563360.SH": { "assetClass": "å…¬å‹Ÿè‚¡ç¥¨åŸºé‡‘", "style": "å‡è¡¡", "equityPosition": 100 },
    "588000.SH": { "assetClass": "å…¬å‹Ÿè‚¡ç¥¨åŸºé‡‘", "style": "ç§‘æŠ€æˆé•¿", "equityPosition": 100 },
    "159351.SZ": { "assetClass": "å…¬å‹Ÿè‚¡ç¥¨åŸºé‡‘", "style": "å‡è¡¡", "equityPosition": 100 },
    "010003.OF": { "assetClass": "å…¬å‹Ÿè‚¡ç¥¨åŸºé‡‘", "style": "ç§‘æŠ€æˆé•¿", "equityPosition": 100 },
    "æ™¯é¡ºé•¿åŸç¯ä¿ä¼˜åŠ¿(001975.OF)": { "assetClass": "å…¬å‹Ÿè‚¡ç¥¨åŸºé‡‘", "style": "ç§‘æŠ€æˆé•¿", "equityPosition": 100 },
    "520990.SH": { "assetClass": "å…¬å‹Ÿè‚¡ç¥¨åŸºé‡‘", "style": "çº¢åˆ©", "equityPosition": 100 },
    "515100.SH": { "assetClass": "å…¬å‹Ÿè‚¡ç¥¨åŸºé‡‘", "style": "çº¢åˆ©", "equityPosition": 100 },
    "ä¸­è¯800äº¤æ˜“å‹å¼€æ”¾å¼æŒ‡æ•°è¯åˆ¸æŠ•èµ„åŸºé‡‘": { "assetClass": "å…¬å‹Ÿè‚¡ç¥¨åŸºé‡‘", "style": "å‡è¡¡", "equityPosition": 100 },
    "å®ç›ˆå“è´¨ç”„é€‰æ··åˆå‹è¯åˆ¸æŠ•èµ„åŸºé‡‘": { "assetClass": "å…¬å‹Ÿæ··åˆåŸºé‡‘", "style": "ä»·å€¼", "equityPosition": 100 },
    "012125.OF": { "assetClass": "å…¬å‹Ÿæ··åˆåŸºé‡‘", "style": "ç§‘æŠ€æˆé•¿", "equityPosition": 100 },
    "018225.OF": { "assetClass": "å…¬å‹Ÿæ··åˆåŸºé‡‘", "style": "ä»·å€¼", "equityPosition": 100 },
    "010372.OF": { "assetClass": "å…¬å‹Ÿæ··åˆåŸºé‡‘", "style": "ç§‘æŠ€æˆé•¿", "equityPosition": 100 },
    "001300.OF": { "assetClass": "å…¬å‹Ÿæ··åˆåŸºé‡‘", "style": "å‘¨æœŸ", "equityPosition": 100 },
    "001301.OF": { "assetClass": "å…¬å‹Ÿæ··åˆåŸºé‡‘", "style": "å‘¨æœŸ", "equityPosition": 100 },
    "010625.OF": { "assetClass": "å…¬å‹Ÿæ··åˆåŸºé‡‘", "style": "å‡è¡¡", "equityPosition": 100 },
    "å¹¿å‘ä¸»é¢˜é¢†å…ˆçµæ´»é…ç½®æ··åˆå‹è¯åˆ¸æŠ•èµ„åŸºé‡‘": { "assetClass": "å…¬å‹Ÿæ··åˆåŸºé‡‘", "style": "ä»·å€¼", "equityPosition": 100 },
    "åå•†æ–°è¶‹åŠ¿ä¼˜é€‰(166301.OF)": { "assetClass": "å…¬å‹Ÿæ··åˆåŸºé‡‘", "style": "å‡è¡¡", "equityPosition": 100 },
    "017043.OF": { "assetClass": "å…¬å‹Ÿæ··åˆåŸºé‡‘", "style": "ä»·å€¼", "equityPosition": 100 },
    "260101.OF": { "assetClass": "å…¬å‹Ÿæ··åˆåŸºé‡‘", "style": "ç§‘æŠ€æˆé•¿", "equityPosition": 100 },
    "ä¸‡å®¶å®è§‚æ‹©æ—¶å¤šç­–ç•¥çµæ´»é…ç½®æ··åˆå‹è¯åˆ¸æŠ•èµ„åŸºé‡‘": { "assetClass": "å…¬å‹Ÿæ··åˆåŸºé‡‘", "style": "å‘¨æœŸ", "equityPosition": 100 },
    "015566.OF": { "assetClass": "å…¬å‹Ÿæ··åˆåŸºé‡‘", "style": "å‘¨æœŸ", "equityPosition": 100 },
    "020199.OF": { "assetClass": "å…¬å‹Ÿæ··åˆåŸºé‡‘", "style": "å‘¨æœŸ", "equityPosition": 100 },
    "æ˜“æ–¹è¾¾è£•æƒ å›æŠ¥å®šæœŸå¼€æ”¾å¼æ··åˆå‹å‘èµ·å¼è¯åˆ¸æŠ•èµ„åŸºé‡‘": { "assetClass": "å…¬å‹Ÿæ··åˆåŸºé‡‘", "style": "å‡è¡¡", "equityPosition": 100 },
    "011691.OF": { "assetClass": "å…¬å‹Ÿæ··åˆåŸºé‡‘", "style": "å‡è¡¡", "equityPosition": 100 },
    "023452.OF": { "assetClass": "å…¬å‹Ÿæ··åˆåŸºé‡‘", "style": "ç§‘æŠ€æˆé•¿", "equityPosition": 100 },
    "012778.OF": { "assetClass": "å…¬å‹Ÿæ··åˆåŸºé‡‘", "style": "å‡è¡¡", "equityPosition": 100 },
    "006567.OF": { "assetClass": "å…¬å‹Ÿæ··åˆåŸºé‡‘", "style": "ä»·å€¼", "equityPosition": 100 },
    "ä¸­æ³°å…ƒå’Œä»·å€¼ç²¾é€‰æ··åˆå‹è¯åˆ¸æŠ•èµ„åŸºé‡‘": { "assetClass": "å…¬å‹Ÿæ··åˆåŸºé‡‘", "style": "ä»·å€¼", "equityPosition": 100 },
    "513010.SH": { "assetClass": "å…¶ä»–å…¬å‹ŸåŸºé‡‘", "style": "ç§‘æŠ€æˆé•¿", "equityPosition": 100 },
    "009879.OF": { "assetClass": "åè‚¡æ··åˆå‹åŸºé‡‘", "style": "å‡è¡¡", "equityPosition": 100 },
    "011066.OF": { "assetClass": "æ™®é€šè‚¡ç¥¨å‹åŸºé‡‘", "style": "ä»·å€¼", "equityPosition": 100 },
    "016841.OF": { "assetClass": "åè‚¡æ··åˆå‹åŸºé‡‘", "style": "å‡è¡¡", "equityPosition": 100 },
    "017750.OF": { "assetClass": "åè‚¡æ··åˆå‹åŸºé‡‘", "style": "å‘¨æœŸ", "equityPosition": 100 },
    "515220.SH": { "assetClass": "è¢«åŠ¨æŒ‡æ•°å‹åŸºé‡‘", "style": "å‘¨æœŸ", "equityPosition": 100 },
    "018505.OF": { "assetClass": "åè‚¡æ··åˆå‹åŸºé‡‘", "style": "å‘¨æœŸ", "equityPosition": 100 },
    "009878.OF": { "assetClass": "åè‚¡æ··åˆå‹åŸºé‡‘", "style": "å‡è¡¡", "equityPosition": 100 },
    "018993.OF": { "assetClass": "åè‚¡æ··åˆå‹åŸºé‡‘", "style": "ç§‘æŠ€æˆé•¿", "equityPosition": 100 },
    "024919.OF": { "assetClass": "çµæ´»é…ç½®å‹åŸºé‡‘", "style": "çº¢åˆ©", "equityPosition": 100 },
    "001258.OF": { "assetClass": "æ··åˆå€ºåˆ¸å‹äºŒçº§åŸºé‡‘", "style": "å‡è¡¡", "equityPosition": 20 },
    "015364.OF": { "assetClass": "æ™®é€šè‚¡ç¥¨å‹åŸºé‡‘", "style": "ä»·å€¼", "equityPosition": 100 },
    "020521.OF": { "assetClass": "æ··åˆå€ºåˆ¸å‹äºŒçº§åŸºé‡‘", "style": "ç§‘æŠ€æˆé•¿", "equityPosition": 20 },
    "001955.OF": { "assetClass": "åè‚¡æ··åˆå‹åŸºé‡‘", "style": "å‡è¡¡", "equityPosition": 100 },
    "010388.OF": { "assetClass": "æ™®é€šè‚¡ç¥¨å‹åŸºé‡‘", "style": "ç§‘æŠ€æˆé•¿", "equityPosition": 100 },
    "014088.OF": { "assetClass": "æ··åˆå€ºåˆ¸å‹äºŒçº§åŸºé‡‘", "style": "ç§‘æŠ€æˆé•¿", "equityPosition": 20 },
    "017941.OF": { "assetClass": "çµæ´»é…ç½®å‹åŸºé‡‘", "style": "ç§‘æŠ€æˆé•¿", "equityPosition": 100 },
    "217023.OF": { "assetClass": "æ··åˆå€ºåˆ¸å‹äºŒçº§åŸºé‡‘", "style": "å‡è¡¡", "equityPosition": 20 },
    "014846.OF": { "assetClass": "æ··åˆå€ºåˆ¸å‹äºŒçº§åŸºé‡‘", "style": "å‘¨æœŸ", "equityPosition": 20 },
    "017475.OF": { "assetClass": "æ··åˆå€ºåˆ¸å‹äºŒçº§åŸºé‡‘", "style": "å‡è¡¡", "equityPosition": 20 },
    "012228.OF": { "assetClass": "åè‚¡æ··åˆå‹åŸºé‡‘", "style": "å‡è¡¡", "equityPosition": 100 },
    "80PF210158": { "assetClass": "å§”å¤–éç°å›ºå®šæ”¶ç›Šç±»èµ„äº§", "style": "å‡è¡¡", "equityPosition": 18 },
    "80PF200133": { "assetClass": "å§”å¤–éç°å›ºå®šæ”¶ç›Šç±»èµ„äº§", "style": "ä»·å€¼", "equityPosition": 19 },
    "11PF252714": { "assetClass": "å§”å¤–éç°å›ºå®šæ”¶ç›Šç±»èµ„äº§", "style": "å‡è¡¡", "equityPosition": 18 },
    "11PF252802": { "assetClass": "å§”å¤–æƒç›Šç±»æŠ•èµ„", "style": "çº¢åˆ©", "equityPosition": 100 },
    "11PF253412": { "assetClass": "å§”å¤–æƒç›Šç±»æŠ•èµ„", "style": "ç§‘æŠ€æˆé•¿", "equityPosition": 100 },
    "å¤§æˆç§‘æŠ€åˆ›æ–°æ··åˆå‹è¯åˆ¸æŠ•èµ„åŸºé‡‘": { "assetClass": "åè‚¡æ··åˆå‹åŸºé‡‘", "style": "ç§‘æŠ€æˆé•¿", "equityPosition": 80 }
};
```

---

## é™„å½•B: AIå¤ç°æŒ‡ä»¤æ¨¡æ¿

å°†æœ¬æ–‡æ¡£æä¾›ç»™AIå·¥å…·æ—¶,ä½¿ç”¨ä»¥ä¸‹æŒ‡ä»¤:

```
ä½ æ˜¯ä¸€ä¸ªé«˜çº§å‰ç«¯å¼€å‘AIåŠ©æ‰‹ã€‚è¯·æ ¹æ®ä»¥ä¸‹å®Œæ•´æŠ€æœ¯è§„æ ¼è¯´æ˜ä¹¦,å®ç°ä¸€ä¸ªåŸºé‡‘åˆ†ç±»æ ‡ç­¾ç®¡ç†ç³»ç»Ÿã€‚

ã€è¦æ±‚ã€‘
1. ä¸¥æ ¼éµå¾ªæ–‡æ¡£ä¸­çš„æ‰€æœ‰è®¡ç®—å…¬å¼(ç¬¬4ç« ),ç¡®ä¿æ•°å€¼è®¡ç®—100%å‡†ç¡®
2. å®Œæ•´å®ç°æ‰€æœ‰åŠŸèƒ½æ¨¡å—(ç¬¬5ç« ),ä¸å¾—é—æ¼ä»»ä½•åŠŸèƒ½
3. UI/UXä¸¥æ ¼ç¬¦åˆç¬¬6ç« è®¾è®¡è§„èŒƒ,åŒ…æ‹¬é¢œè‰²ã€å¸ƒå±€ã€å“åº”å¼
4. ç”Ÿæˆå•ä¸€HTMLæ–‡ä»¶,åŒ…å«æ‰€æœ‰CSSå’ŒJavaScript
5. ç¡®ä¿å®Œå…¨ç¦»çº¿å¯è¿è¡Œ,ä¸ä¾èµ–ä»»ä½•å¤–éƒ¨CDN
6. å®ç°ç¬¬7ç« çš„å®Œæ•´ä»£ç æ¡†æ¶
7. å®ç°æ‰€æœ‰é”™è¯¯å¤„ç†å’Œè¾¹ç•Œæƒ…å†µ
8. ç¡®ä¿é€šè¿‡ç¬¬8ç« çš„æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹

ã€å…³é”®æ³¨æ„äº‹é¡¹ã€‘
- åŸºé‡‘åŒ¹é…é€»è¾‘(getFundMatchKey)æ˜¯æ ¸å¿ƒ,å¿…é¡»å®Œå…¨æŒ‰ç…§æ–‡æ¡£å®ç°
- å‡€èµ„äº§è®¡ç®—å¿…é¡»æ­£ç¡®æ‰£é™¤æ­£å›è´­
- çŸ©é˜µè¡¨æ ¼å æ¯”å¿…é¡»å››èˆäº”å…¥åˆ°æ•´æ•°,ä¸ä¿ç•™å°æ•°
- é£æ ¼æ’åºå¿…é¡»æ˜¯:çº¢åˆ©ã€å‡è¡¡ã€ç§‘æŠ€æˆé•¿ã€å‘¨æœŸã€ä»·å€¼
- æ™ºèƒ½æ£€æµ‹å¿…é¡»ä½¿ç”¨matchKeyä½œä¸ºæ•°æ®åº“é”®,ä¸æ˜¯èµ„äº§ç®€ç§°

ã€æ–‡æ¡£å†…å®¹ã€‘
[ç²˜è´´æœ¬æ–‡æ¡£å®Œæ•´å†…å®¹]

è¯·å¼€å§‹å®ç°,ç¡®ä¿æ¯ä¸€ä¸ªç»†èŠ‚éƒ½ç¬¦åˆè§„æ ¼ã€‚
```

---

**æ–‡æ¡£ç»“æŸ**

**ç‰ˆæœ¬**: v1.1.0
**æ—¥æœŸ**: 2026-01-20
**ä½œè€…**: åŸºé‡‘åˆ†ç±»æ ‡ç­¾ç®¡ç†ç³»ç»Ÿå¼€å‘å›¢é˜Ÿ
**ç”¨é€”**: AIå·¥å…·å®Œæ•´å¤ç°ç³»ç»Ÿ

å¦‚æœ‰ä»»ä½•ç–‘é—®,è¯·å‚è€ƒ fund_analysis.html æºä»£ç æˆ– CLAUDE.md é¡¹ç›®è¯´æ˜ã€‚
