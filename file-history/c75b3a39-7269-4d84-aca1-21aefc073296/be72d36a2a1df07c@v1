# 基金分类数据库更新记录 v1.1.1

## 更新日期
2026-01-13

## 本次更新内容

### 新增基金（3个）

根据最新持仓表 `持仓盈亏明细列表_1765074404831.xlsx` 添加了以下基金：

| 外部代码 | 基金名称 | 资产类型 | 风格 | 权益仓位 |
|---------|---------|---------|------|---------|
| 011690.OF | 招商品质发现混合型证券投资基金 | 偏股混合型基金 | 价值 | 80% |
| 090007.OF | 大成策略回报混合型证券投资基金 | 偏股混合型基金 | 价值 | 80% |
| 010387.OF | 易方达医药生物股票型证券投资基金 | 普通股票型基金 | 科技成长 | 100% |

### 数据库统计
- **更新前总数**: 66个基金
- **更新后总数**: 69个基金
- **新增**: 3个基金

## 数据库键值说明

### 使用外部代码/资产代码作为键的基金（推荐）

绝大多数基金已更新为使用标准代码作为键，例如：
- `"110008.OF"` → 易方达稳健收益B
- `"515100.SH"` → 景顺长城中证红利低波动100ETF
- `"80PF210158"` → 景顺长城鼎安1号集合资产管理计划

### 仍使用完整名称作为键的基金（向后兼容）

以下基金在数据库中仍使用完整名称作为键，原因是它们不在最新持仓表中，保留是为了向后兼容旧持仓表：

| 数据库键值 | 原因 | 建议 |
|-----------|------|------|
| "华泰柏瑞红利ETF ( 510880.SH )" | 不在最新持仓表中 | 保留以兼容历史数据 |
| "景顺长城环保优势（001975.OF）" | 不在最新持仓表中 | 保留以兼容历史数据 |
| "中证800交易型开放式指数证券投资基金" | 不在最新持仓表中 | 保留以兼容历史数据 |
| "宝盈品质甄选混合型证券投资基金" | 不在最新持仓表中 | 保留以兼容历史数据 |
| "广发主题领先灵活配置混合型证券投资基金" | 不在最新持仓表中 | 保留以兼容历史数据 |
| "华商新趋势优选（166301.OF）" | 不在最新持仓表中 | 保留以兼容历史数据 |
| "万家宏观择时多策略灵活配置混合型证券投资基金" | 不在最新持仓表中 | 保留以兼容历史数据 |
| "易方达裕惠回报定期开放式混合型发起式证券投资基金" | 不在最新持仓表中 | 保留以兼容历史数据 |
| "中泰元和价值精选混合型证券投资基金" | 不在最新持仓表中 | 保留以兼容历史数据 |
| "大成科技创新混合型证券投资基金" | 不在最新持仓表中 | 保留以兼容历史数据 |

**注意**: 这些使用名称作为键的基金不会影响系统正常使用，它们仅在处理包含这些基金的历史持仓表时才会被匹配到。

## 匹配逻辑说明

系统的 `getFundMatchKey()` 函数会根据资产类型智能选择匹配键：

```javascript
function getFundMatchKey(row) {
    const assetClass = normalizeText(row['新版资产大类']);
    const externalCode = normalizeText(row['外部代码']);
    const assetCode = normalizeText(row['资产代码']);
    const assetName = normalizeText(row['资产简称']);

    // 对于公募基金,优先使用外部代码
    if (assetClass === '公募基金' && externalCode) {
        return externalCode;
    }

    // 对于委外投资,使用资产代码
    if (assetClass === '委外投资' && assetCode) {
        return assetCode;
    }

    // 其他情况使用资产简称（兼容旧数据）
    return assetName;
}
```

这意味着：
- ✅ 对于最新持仓表中的公募基金，系统会使用外部代码（如 `011690.OF`）进行匹配
- ✅ 对于委外投资，系统会使用资产代码（如 `80PF210158`）进行匹配
- ✅ 对于其他情况或找不到外部代码的历史数据，系统会降级使用资产简称匹配

## 如何使用更新后的数据库

### 方法一：恢复默认（最简单）
1. 打开 `fund_analysis.html`
2. 点击"数据管理"中的 **"🔄 恢复默认"** 按钮
3. 确认操作
4. 系统将自动加载包含69个基金的最新数据库

### 方法二：导入更新的JSON文件
1. 打开 `fund_analysis.html`
2. 点击"数据管理"中的 **"📥 导入基金分类"** 按钮
3. 选择 `基金分类数据_v1.1.0_updated.json` 文件
4. 确认导入

## 验证更新

更新后，请验证以下基金能被正确识别：
- ✓ 招商品质发现混合型证券投资基金 (011690.OF)
- ✓ 大成策略回报混合型证券投资基金 (090007.OF)
- ✓ 易方达医药生物股票型证券投资基金 (010387.OF)

## 常见问题

### Q: 为什么数据库中有些用代码，有些用名称？
**A**: 大部分基金已统一使用外部代码/资产代码作为键。仅有10个不在最新持仓表中的历史基金保留使用名称作为键，这是为了向后兼容旧的持仓表。这不会影响系统正常使用。

### Q: 如果我想清理掉不在当前持仓的历史基金怎么办？
**A**: 可以手动删除那些使用名称作为键的基金条目。但建议保留它们，因为：
1. 不会影响系统性能
2. 如果将来需要分析历史持仓表时会用到
3. 占用空间很小

### Q: 新添加的基金如何选择风格和权益仓位的？
**A**:
- **招商品质发现混合A** - 价值风格，权益仓位80%（偏股混合型基金默认80%）
- **大成策略回报混合A** - 价值风格，权益仓位80%（偏股混合型基金默认80%）
- **易方达医药生物股票A** - 科技成长风格，权益仓位100%（普通股票型基金默认100%）

风格选择基于基金名称和投资方向分析得出，您可以根据实际情况在系统中调整。

## 下一步建议

1. **测试最新持仓表**: 上传 `持仓盈亏明细列表_1765074404831.xlsx` 验证所有基金都能正确识别
2. **检查未分类基金**: 如果还有未分类的含权基金，使用批量添加功能补充
3. **定期备份**: 使用"导出基金分类"功能定期备份您的分类数据
